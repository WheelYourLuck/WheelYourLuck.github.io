<!DOCTYPE html>
<html lang="en">
<head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-204SCVQ959"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-204SCVQ959');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4359125303604791"
     crossorigin="anonymous"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Spin Wheel</title>
    <style>
        :root {
            --primary-color: #6c5ce7;
            --secondary-color: #a29bfe;
            --accent-color: #fd79a8;
            --dark-color: #2d3436;
            --light-color: #f5f6fa;
            --positive-color: #00b894;
            --negative-color: #d63031;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #f5576c, #4facfe, #00f2fe);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--light-color);
            padding: 20px;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Floating particles background */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            z-index: 1;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            text-align: center;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientText 3s ease infinite, titlePulse 2s ease-in-out infinite;
        }

        .subtitle {
            text-align: center;
            margin-top: -2px;
            margin-bottom: 6px;
            font-size: 1rem;
            line-height: 1.4;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.25);
        }

        @keyframes gradientText {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .controls-panel {
            width: 100%;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-between;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
            flex-grow: 1;
        }
        
        label {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        input, select, button, textarea {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus, button:focus, textarea:focus {
            outline: none;
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.3);
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            background-color: #5649c0;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background-color: #b2b2b2;
            cursor: not-allowed;
            transform: none;
        }
        
        button i {
            font-size: 1rem;
        }
        
        .wheel-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 20px 0 60px 0;
            cursor: pointer;
            transition: transform 0.2s;
            border-radius: 50%;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.3),
                0 0 60px rgba(255, 255, 255, 0.1),
                inset 0 0 0 8px rgba(255, 255, 255, 0.8);
            background: white;
            overflow: hidden;
            animation: wheelGlow 3s ease-in-out infinite alternate;
            transform-style: preserve-3d;
            will-change: transform;
        }

        @keyframes wheelGlow {
            0% {
                box-shadow: 
                    0 10px 30px rgba(0, 0, 0, 0.3),
                    0 0 60px rgba(255, 255, 255, 0.1),
                    inset 0 0 0 8px rgba(255, 255, 255, 0.8);
            }
            100% {
                box-shadow: 
                    0 15px 40px rgba(0, 0, 0, 0.4),
                    0 0 80px rgba(255, 215, 0, 0.3),
                    inset 0 0 0 8px rgba(255, 215, 0, 0.6);
            }
        }

        .wheel-container.spinning {
            animation: wheelGlow 0.1s ease-in-out infinite alternate, spinningGlow 0.2s ease-in-out infinite;
        }

        .wheel-container.spinning::after {
            animation: spinningArrow 0.3s ease-in-out infinite, arrowPulse 2s ease-in-out infinite;
            border-top-color: #ff0080;
        }

        @keyframes spinningArrow {
            0%, 100% {
                filter: drop-shadow(0 8px 16px rgba(255,0,128,0.9)) brightness(1.5);
                transform: translateX(-50%) scale(1.2);
            }
            50% {
                filter: drop-shadow(0 12px 24px rgba(0,255,255,0.9)) brightness(1.8);
                transform: translateX(-50%) scale(1.3);
            }
        }

        @keyframes spinningGlow {
            0% {
                box-shadow: 
                    0 15px 40px rgba(0, 0, 0, 0.4),
                    0 0 100px rgba(255, 0, 150, 0.6),
                    inset 0 0 0 8px rgba(255, 0, 150, 0.8);
            }
            50% {
                box-shadow: 
                    0 15px 40px rgba(0, 0, 0, 0.4),
                    0 0 100px rgba(0, 255, 255, 0.6),
                    inset 0 0 0 8px rgba(0, 255, 255, 0.8);
            }
            100% {
                box-shadow: 
                    0 15px 40px rgba(0, 0, 0, 0.4),
                    0 0 100px rgba(255, 255, 0, 0.6),
                    inset 0 0 0 8px rgba(255, 255, 0, 0.8);
            }
        }

        .wheel-container::after {
            content: "";
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 45px solid #ff6b35;
            z-index: 25;
            filter: drop-shadow(0 6px 12px rgba(0,0,0,0.6));
            animation: arrowPulse 2s ease-in-out infinite;
            transform-origin: center bottom;
        }

        .wheel-container::before {
            content: "";
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 22px solid transparent;
            border-right: 22px solid transparent;
            border-top: 48px solid #333;
            z-index: 24;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        
        .wheel-container:hover {
            transform: scale(1.03);
        }

        /* Enhanced Result Display */
        .result-display {
            width: 100%;
            max-width: 500px;
            margin: 30px auto;
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(240,248,255,0.9));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 
                0 15px 35px rgba(0,0,0,0.1),
                0 5px 15px rgba(0,0,0,0.08),
                inset 0 1px 0 rgba(255,255,255,0.6);
            border: 1px solid rgba(255,255,255,0.3);
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .result-display.show {
            opacity: 1;
            transform: translateY(0);
        }

        .result-display.winner {
            animation: winnerPulse 1.5s ease-in-out infinite alternate;
        }

        .result-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .result-header h3 {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .result-icon {
            font-size: 1.8rem;
            color: #f39c12;
            animation: iconBounce 2s ease-in-out infinite;
        }

        .result-content {
            margin: 20px 0;
            position: relative;
        }

        .result-text {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
            padding: 15px;
            border-radius: 12px;
            background-color: rgba(255,255,255,0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.6);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result-celebration {
            margin-top: 15px;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.5s ease;
        }

        .result-celebration.show {
            opacity: 1;
            transform: scale(1);
        }

        .celebration-text {
            font-size: 1.2rem;
            font-weight: bold;
            color: #e74c3c;
            animation: celebrationGlow 1s ease-in-out infinite alternate;
        }

        @keyframes winnerPulse {
            0% {
                box-shadow: 
                    0 15px 35px rgba(0,0,0,0.1),
                    0 5px 15px rgba(0,0,0,0.08),
                    0 0 0 0 rgba(102, 126, 234, 0.4);
            }
            100% {
                box-shadow: 
                    0 20px 45px rgba(0,0,0,0.15),
                    0 8px 25px rgba(0,0,0,0.12),
                    0 0 0 10px rgba(102, 126, 234, 0.1);
            }
        }

        @keyframes iconBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes celebrationGlow {
            0% {
                text-shadow: 0 0 5px rgba(231, 76, 60, 0.5);
                transform: scale(1);
            }
            100% {
                text-shadow: 0 0 15px rgba(231, 76, 60, 0.8), 0 0 25px rgba(255, 193, 7, 0.6);
                transform: scale(1.05);
            }
        }
        
        #wheel {
            width: 100%;
            height: 100%;
            position: relative;
            border-radius: 50%;
            overflow: hidden;
            transition: transform 12s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            transform: rotate(0deg);
        }

        .wheel-slice {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            top: 50%;
            left: 50%;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .wheel-slice-text {
            position: absolute;
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            transform-origin: center;
            white-space: nowrap;
        }

        .wheel-center {
            position: absolute;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 
                0 4px 15px rgba(0,0,0,0.4),
                inset 0 2px 4px rgba(255,255,255,0.1),
                inset 0 -2px 4px rgba(0,0,0,0.2);
            border: 3px solid #ffffff;
            cursor: pointer;
            transition: all 0.1s ease;
            outline: 2px solid #bdc3c7;
            outline-offset: 2px;
        }

        .wheel-center:hover {
            transform: translate(-50%, -50%) scale(1.05);
            box-shadow: 
                0 6px 20px rgba(0,0,0,0.5),
                inset 0 2px 4px rgba(255,255,255,0.2),
                inset 0 -2px 4px rgba(0,0,0,0.3);
        }

        .wheel-center:active {
            transform: translate(-50%, -50%) scale(0.95);
            box-shadow: 
                0 2px 8px rgba(0,0,0,0.3),
                inset 0 2px 4px rgba(0,0,0,0.2),
                inset 0 -1px 2px rgba(255,255,255,0.1);
        }

        .wheel-center span {
            color: white;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            letter-spacing: 0.5px;
        }
        
        .result-container {
            width: 100%;
            max-width: 600px;
            text-align: center;
            margin-top: 20px;
        }
        
        #result {
            font-size: 2rem;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255,255,255,0.4);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            animation: resultPulse 2s ease-in-out infinite;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.5s ease;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        @keyframes resultPulse {
            0%, 100% {
                transform: scale(1);
                text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            }
            50% {
                transform: scale(1.02);
                text-shadow: 0 0 20px rgba(255,255,255,0.8), 2px 2px 4px rgba(0,0,0,0.5);
            }
        }

        .result.winner {
            animation: winnerCelebration 1s ease-in-out;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            transform: scale(1.1);
        }

        @keyframes winnerCelebration {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.2) rotate(-5deg); }
            50% { transform: scale(1.1) rotate(5deg); }
            75% { transform: scale(1.2) rotate(-5deg); }
            100% { transform: scale(1.1) rotate(0deg); }
        }
        
        #result.show {
            opacity: 1;
            transform: scale(1);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(253, 121, 168, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(253, 121, 168, 0); }
            100% { box-shadow: 0 0 0 0 rgba(253, 121, 168, 0); }
        }
        
        .slice-config {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }
        
        .slice-item {
            display: flex;
            gap: 15px;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 8px;
            transition: transform 0.18s ease, background 0.18s ease, box-shadow 0.18s ease;
        }

        .slice-item:focus-within {
            background: rgba(255, 255, 255, 0.28);
            transform: translateY(-1px);
            box-shadow: 0 10px 24px rgba(0,0,0,0.18);
        }

        .slice-item.edited {
            animation: sliceEditedPop 420ms ease-out;
        }

        @keyframes sliceEditedPop {
            0% { transform: translateY(0) scale(1); }
            40% { transform: translateY(-2px) scale(1.015); }
            100% { transform: translateY(0) scale(1); }
        }

        @media (prefers-reduced-motion: reduce) {
            body {
                animation: none !important;
            }
            .wheel-container,
            h1 {
                animation: none !important;
                transition: none !important;
            }
            .particle {
                animation: none !important;
            }
        }
        
        .slice-item label {
            min-width: 80px;
        }
        
        .save-load-container {
            display: flex;
            gap: 15px;
            width: 100%;
        }
        
        .save-load-container textarea {
            flex-grow: 1;
            min-height: 100px;
            resize: vertical;
        }
        
        .save-load-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 150px;
        }
        
        .saved-wheels-container {
            width: 100%;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .saved-wheels-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .saved-wheel-item {
            background: rgba(255, 255, 255, 0.3);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .saved-wheel-item:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-3px);
        }
        
        .saved-wheel-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .saved-wheel-date {
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .saved-wheel-delete {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.7rem;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--accent-color);
            opacity: 0;
            z-index: 0;
        }
        
        .wheel-name-input {
            width: 100%;
            margin-bottom: 15px;
        }
        
        .file-input-container {
            position: relative;
            width: 100%;
        }
        
        .file-input-label {
            display: block;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .file-input-label:hover {
            background: rgba(255, 255, 255, 1);
        }
        
        .file-input {
            position: absolute;
            width: 0.1px;
            height: 0.1px;
            opacity: 0;
            overflow: hidden;
            z-index: -1;
        }
        
        .preset-wheels {
            width: 100%;
            margin-top: 20px;
            display: none;
        }
        
        .preset-wheels.show {
            display: block;
        }
        
        .preset-wheels h2 {
            margin-bottom: 15px;
        }
        
        .preset-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .menu-button {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .menu-button:hover {
            transform: scale(1.1);
        }
        
        .menu-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 300px;
            height: 100vh;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            padding: 20px;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 999;
            overflow-y: auto;
            color: white;
        }
        
        .menu-panel.show {
            transform: translateX(0);
        }
        
        .menu-panel h2 {
            margin-bottom: 20px;
            color: var(--accent-color);
        }
        
        .menu-panel button {
            width: 100%;
            margin-bottom: 10px;
            background-color: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .menu-panel .menu-link {
            width: 100%;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 15px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: bold;
            color: white;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .menu-panel .menu-link i {
            color: #ff0000;
            font-size: 1rem;
        }
        
        .menu-panel button:hover {
            background-color: var(--primary-color);
        }

        .menu-panel .menu-link:hover {
            background-color: #ff0000;
            transform: translateY(-2px);
        }

        .menu-panel .menu-link:hover i {
            color: white;
        }
        
        .audio-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .audio-toggle:hover {
            transform: scale(1.1);
        }
        
        .audio-toggle.muted {
            background-color: var(--negative-color);
        }
        
        @media (max-width: 768px) {
            .controls-panel {
                flex-direction: column;
            }
            
            .wheel-container {
                width: 300px;
                height: 300px;
            }
            
            .save-load-container {
                flex-direction: column;
            }
            
            .saved-wheels-list {
                grid-template-columns: 1fr;
            }
            
            .preset-buttons {
                flex-direction: column;
            }
            
            .menu-panel {
                width: 250px;
            }
        }

        /* Wheel Info Panel Styles */
        .wheel-info-button {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: #ffffff;
            color: #2c3e50;
            border: 3px solid #667eea;
            padding: 18px 30px;
            border-radius: 35px;
            cursor: pointer;
            font-weight: 900;
            font-size: 18px;
            font-family: 'Arial', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            z-index: 15;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-shadow: none;
        }

        .wheel-info-button:hover {
            transform: translateX(-50%) translateY(-3px) scale(1.05);
            background: #667eea;
            color: white;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            border-color: #ffffff;
        }

        .wheel-info-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, rgba(255,255,255,0.98), rgba(255,255,255,0.95));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            z-index: 1000;
            max-width: 500px;
            width: 90%;
            transition: all 0.3s ease;
            border: 3px solid rgba(100,100,100,0.3);
            color: #2c3e50;
            font-weight: 500;
        }

        /* When history is expanded, use a fullscreen layout so results can fit on one screen */
        .wheel-info-panel.history-expanded {
            top: 50%;
            left: 50%;
            max-width: min(1400px, 96vw);
            width: 96vw;
            height: 92vh;
            padding: 18px;
            display: flex;
            flex-direction: column;
        }

        .wheel-info-panel.history-expanded .wheel-stats {
            margin-bottom: 12px;
        }

        .wheel-info-panel.history-expanded .win-history {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .wheel-info-panel.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .wheel-info-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .wheel-info-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .wheel-info-header {
            text-align: center;
            margin-bottom: 25px;
            color: #2c3e50;
        }

        .wheel-info-header h2 {
            margin: 0 0 10px 0;
            font-size: 24px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .wheel-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(102, 126, 234, 0.3);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #4a5bb8;
            margin-bottom: 8px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .stat-label {
            font-size: 14px;
            color: #2c3e50;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .win-history {
            margin-bottom: 20px;
        }

        .win-history-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 15px;
        }

        .win-history-header h3 {
            color: #2c3e50;
            margin: 0;
            font-size: 18px;
        }

        .win-history-toggle {
            background: rgba(0, 0, 0, 0.06);
            color: #2c3e50;
            border: none;
            border-radius: 10px;
            padding: 8px 10px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            transition: all 0.2s ease;
        }

        .win-history-toggle:hover {
            background: rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .win-history-toggle:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .win-list {
            background: rgba(0,0,0,0.05);
            border-radius: 10px;
            padding: 10px;
            transition: all 0.3s ease;
        }

        /* Default: keep the current compact scrolling behavior */
        .win-list.collapsed {
            max-height: 200px;
            overflow-y: auto;
        }

        /* Expanded: NO SCROLL. Fit everything into the available viewport area using columns.
           (If there are too many items, they will be squeezed smaller via the "compact" class.) */
        .win-list.expanded {
            flex: 1;
            min-height: 0;
            overflow: hidden;
            max-height: none;
            padding: 10px;

            /* Defaults that JS can override to fit all results on one screen */
            --win-item-gap: 8px;
            --win-item-padding-y: 8px;
            --win-item-padding-x: 12px;
            --win-item-font-size: 14px;
            --win-date-font-size: 12px;
            --delete-btn-size: 24px;
            --delete-btn-font-size: 16px;

            /* Multi-column flow makes better use of horizontal space */
            column-count: 3;
            column-gap: 12px;
            column-fill: auto;
        }

        @media (max-width: 1100px) {
            .wheel-info-panel.history-expanded .win-list.expanded { column-count: 2; }
        }

        @media (max-width: 700px) {
            .wheel-info-panel.history-expanded .win-list.expanded { column-count: 1; }
        }

        .wheel-info-panel.history-expanded .win-list.expanded {
            width: 100%;
        }

        .win-list.expanded .win-item {
            break-inside: avoid;
            margin: 0 0 var(--win-item-gap) 0;
        }

        /* When expanded, allow JS-driven fitting */
        .wheel-info-panel.history-expanded .win-list.expanded .win-item {
            padding: var(--win-item-padding-y) var(--win-item-padding-x);
        }

        .wheel-info-panel.history-expanded .win-list.expanded .win-text {
            font-size: var(--win-item-font-size);
            line-height: 1.1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
        }

        .wheel-info-panel.history-expanded .win-list.expanded .win-date {
            font-size: var(--win-date-font-size);
        }

        .wheel-info-panel.history-expanded .win-list.expanded.fit-hide-date .win-date {
            display: none;
        }

        .wheel-info-panel.history-expanded .win-list.expanded .delete-spin-btn {
            width: var(--delete-btn-size);
            height: var(--delete-btn-size);
            font-size: var(--delete-btn-font-size);
        }

        /* Compact mode: smaller rows + hide date to fit huge histories into one screen */
        .wheel-info-panel.history-expanded .win-list.expanded.compact .win-item {
            padding: 6px 10px;
        }

        .wheel-info-panel.history-expanded .win-list.expanded.compact .win-date {
            display: none;
        }

        .wheel-info-panel.history-expanded .win-list.expanded.compact .delete-spin-btn {
            width: 20px;
            height: 20px;
            font-size: 14px;
        }

        /* Expanded has no scrollbar by design */

        /* Smooth scrollbar for collapsed view too */
        .win-list.collapsed::-webkit-scrollbar {
            width: 8px;
        }

        .win-list.collapsed::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
            border-radius: 4px;
        }

        .win-list.collapsed::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
        }

        .win-list.collapsed::-webkit-scrollbar-thumb:hover {
            background: rgba(0,0,0,0.3);
        }

        .delete-spin-btn {
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            padding: 0;
            box-shadow: 0 2px 4px rgba(255, 71, 87, 0.3);
        }

        .delete-spin-btn:hover {
            background: #ee5a6f;
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(255, 71, 87, 0.5);
        }

        .delete-spin-btn:active {
            transform: scale(0.95);
        }

        .win-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .win-text {
            font-weight: bold;
            color: #2c3e50;
        }

        .win-date {
            color: #666;
            font-size: 0.9em;
            margin-right: 10px;
            white-space: nowrap;
        }

        .win-count {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .close-info {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease;
        }

        .close-info:hover {
            color: #667eea;
        }

        #resetStatsBtn:hover {
            background: linear-gradient(135deg, #ff5252, #e53e3e) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 16px rgba(255,107,107,0.4) !important;
        }

        /* Cool Animations */
        @keyframes arrowPulse {
            0%, 100% { 
                filter: drop-shadow(0 6px 12px rgba(0,0,0,0.6)) brightness(1);
                transform: translateX(-50%) scale(1);
            }
            50% { 
                filter: drop-shadow(0 8px 16px rgba(255,107,53,0.9)) brightness(1.3);
                transform: translateX(-50%) scale(1.1);
            }
        }

        @keyframes rainbow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(102, 126, 234, 0.5); }
            50% { box-shadow: 0 0 40px rgba(102, 126, 234, 1), 0 0 60px rgba(118, 75, 162, 0.8); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* Rainbow Mode */
        .rainbow-mode .wheel-container {
            animation: rainbow 3s linear infinite;
        }

        .rainbow-mode .wheel-info-button {
            animation: rainbow 2s linear infinite, float 3s ease-in-out infinite;
        }

        /* Dark Mode */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #ffffff;
        }

        body.dark-mode .controls-panel {
            background: rgba(0,0,0,0.8);
            border: 2px solid #667eea;
        }

        body.dark-mode .wheel-info-panel {
            background: linear-gradient(135deg, rgba(26,26,46,0.95), rgba(22,33,62,0.9));
            color: #ffffff;
            border: 3px solid #667eea;
        }

        /* Neon Mode */
        .neon-mode .wheel-container {
            box-shadow: 
                0 0 30px #00ffff,
                0 0 60px #ff00ff,
                0 0 90px #ffff00;
            animation: glow 2s ease-in-out infinite;
        }

        .neon-mode .wheel-info-button {
            background: #000;
            color: #00ffff;
            border: 2px solid #00ffff;
            text-shadow: 0 0 10px #00ffff;
            box-shadow: 0 0 20px #00ffff;
        }

        /* 3D Mode */
        .mode-3d .wheel-container {
            perspective: 1000px;
            transform-style: preserve-3d;
            animation: rotate3d 10s linear infinite;
        }

        @keyframes rotate3d {
            0% { transform: rotateY(0deg) rotateX(10deg); }
            25% { transform: rotateY(90deg) rotateX(10deg); }
            50% { transform: rotateY(180deg) rotateX(10deg); }
            75% { transform: rotateY(270deg) rotateX(10deg); }
            100% { transform: rotateY(360deg) rotateX(10deg); }
        }

        /* Disco Ball Effect */
        .disco-mode::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255,0,255,0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0,255,255,0.3) 0%, transparent 50%),
                radial-gradient(circle at 60% 20%, rgba(255,255,0,0.3) 0%, transparent 50%);
            animation: discoMove 4s ease-in-out infinite;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes discoMove {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(20px, -20px) rotate(90deg); }
            50% { transform: translate(-20px, 20px) rotate(180deg); }
            75% { transform: translate(-20px, -20px) rotate(270deg); }
        }

        /* Cool UI Elements */
        .theme-selector {
            position: fixed;
            top: 80px;
            left: 20px;
            z-index: 1001;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            transform: translateX(0);
        }

        .theme-selector.hidden {
            transform: translateX(-100px);
            opacity: 0;
            pointer-events: none;
        }

        .theme-close-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            border: none;
            border-radius: 50%;
            background: #ff4757;
            color: white;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 1002;
        }

        .theme-close-btn:hover {
            background: #ff3838;
            transform: scale(1.1);
        }

        .theme-show-btn {
            position: fixed;
            top: 80px;
            left: 20px;
            z-index: 1001;
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-size: 16px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .theme-show-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        .theme-show-btn.visible {
            display: flex;
        }

        .theme-button {
            display: block;
            width: 40px;
            height: 40px;
            margin: 5px 0;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
        }

        .theme-button:hover {
            transform: scale(1.2);
        }

        .theme-normal { background: linear-gradient(45deg, #667eea, #764ba2); }
        .theme-dark { background: linear-gradient(45deg, #1a1a2e, #16213e); }
        .theme-rainbow { background: linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #8b00ff); }
        .theme-neon { background: linear-gradient(45deg, #000, #00ffff); }
        .theme-3d { background: linear-gradient(45deg, #667eea, #764ba2); }
        .theme-disco { background: linear-gradient(45deg, #ff00ff, #00ffff, #ffff00); }

        /* Screen Shake Effect */
        .screen-shake {
            animation: shake 0.5s ease-in-out;
        }

        /* Winner Celebration Enhancement */
        .mega-winner {
            animation: rainbow 1s linear infinite, shake 0.1s ease-in-out infinite;
        }

        /* NEW COOL FEATURES */

        /* Wheel Battles */
        .wheel-battles {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .battle-arena {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 20px 0;
        }

        .battle-wheel {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 3px solid white;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .battle-wheel:hover {
            transform: scale(1.1);
        }

        .battle-wheel.winner {
            animation: battleWin 1s ease-in-out;
            box-shadow: 0 0 30px #ffd700;
        }

        @keyframes battleWin {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .vs-text {
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        /* Wheel Casino */
        .wheel-casino {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .casino-chips {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .chip {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            border: 3px solid white;
        }

        .chip:hover {
            transform: scale(1.2);
        }

        .chip-1 { background: #e74c3c; }
        .chip-5 { background: #3498db; }
        .chip-10 { background: #2ecc71; }
        .chip-25 { background: #f39c12; }
        .chip-100 { background: #9b59b6; }

        .coins-display {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 15px 0;
            color: #f1c40f;
        }

        /* Weather Wheel */
        .weather-wheel {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .weather-info {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 20px 0;
        }

        .weather-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        /* Multiplayer */
        .multiplayer-lobby {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .player-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .player-card {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(10px);
        }

        .player-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        /* Social Features */
        .social-panel {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .share-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .share-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .share-btn:hover {
            transform: scale(1.1);
        }

        .share-twitter { background: #1da1f2; color: white; }
        .share-facebook { background: #4267B2; color: white; }
        .share-instagram { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); color: white; }
        .share-tiktok { background: #000; color: white; }

        /* Mini Games */
        .mini-games {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .mini-game-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-weight: bold;
        }

        .mini-game-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        /* Voice Commands */
        .voice-control {
            background: linear-gradient(135deg, #00b894, #00a085);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .mic-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
        }

        .mic-button:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .mic-button.listening {
            animation: pulse 1s ease-in-out infinite;
            background: #e74c3c;
        }

        /* Custom Backgrounds */
        .background-selector {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .bg-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .bg-option {
            width: 100px;
            height: 60px;
            border-radius: 10px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .bg-option:hover {
            transform: scale(1.1);
        }

        .bg-option.active {
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.5);
        }

        .bg-space { background: linear-gradient(135deg, #000428, #004e92); }
        .bg-ocean { background: linear-gradient(135deg, #667eea, #764ba2); }
        .bg-sunset { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .bg-forest { background: linear-gradient(135deg, #4facfe, #00f2fe); }

        /* Leaderboard */
        .leaderboard {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            color: #2c3e50;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: rgba(255,255,255,0.7);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .leaderboard-item:hover {
            transform: scale(1.02);
        }

        .rank-medal {
            font-size: 1.5rem;
            margin-right: 15px;
        }

        .player-name {
            font-weight: bold;
            flex-grow: 1;
        }

        .player-score {
            font-weight: bold;
            color: #667eea;
        }

        /* Wheel Customizer */
        .wheel-customizer {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .customizer-section {
            margin: 20px 0;
        }

        .color-picker-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .color-picker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .color-picker:hover {
            transform: scale(1.2);
        }

        .color-picker.selected {
            border-color: white;
            box-shadow: 0 0 15px rgba(255,255,255,0.7);
        }

        /* Slot Machine Effect */
        .slot-machine {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .slot-reels {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .slot-reel {
            width: 80px;
            height: 100px;
            border: 3px solid #f1c40f;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            background: white;
        }

        .slot-symbols {
            position: absolute;
            width: 100%;
            animation: slotSpin 2s ease-out;
        }

        @keyframes slotSpin {
            0% { transform: translateY(-500px); }
            100% { transform: translateY(0); }
        }

        .slot-symbol {
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #2c3e50;
        }

        /* Prediction Mode */
        .prediction-mode {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .prediction-input {
            background: rgba(255,255,255,0.9);
            border: 2px solid #4a5bb8;
            padding: 12px;
            border-radius: 8px;
            color: #2c3e50;
            margin: 10px;
            font-weight: bold;
            font-size: 16px;
        }

        .prediction-input::placeholder {
            color: rgba(44,62,80,0.7);
        }

        .prediction-input:focus {
            outline: none;
            background: rgba(255,255,255,1);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }

        /* Wheel Designer */
        .wheel-designer {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .design-tools {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .design-tool {
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .design-tool:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }

        /* Reality Check Mode */
        .reality-check {
            background: linear-gradient(135deg, #ff7675, #fd79a8);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .reality-timer {
            font-size: 2rem;
            font-weight: bold;
            margin: 15px 0;
        }

        /* Tournament Mode */
        .tournament-bracket {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .bracket-round {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }

        .bracket-match {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 15px;
            min-width: 150px;
            text-align: center;
        }

        /* Karma System */
        .karma-display {
            background: linear-gradient(135deg, #00b894, #00a085);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .karma-bar {
            width: 200px;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            margin: 15px auto;
            overflow: hidden;
            position: relative;
        }

        .karma-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #00a085);
            transition: width 0.5s ease;
        }

        /* Secret Achievements */
        .secret-achievement {
            background: linear-gradient(135deg, #2d3436, #636e72);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .secret-achievement::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: secretSpin 3s linear infinite;
        }

        @keyframes secretSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .secret-content {
            position: relative;
            z-index: 2;
        }





        /* Enhanced Animations and Effects */
        @keyframes gemFloat {
            0% {
                transform: translate(-50%, -50%) scale(0.5) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -150px) scale(1.2) rotate(180deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -250px) scale(0.3) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes achievementGlow {
            0% {
                transform: scale(0.5) rotate(0deg);
                opacity: 1;
                filter: brightness(1);
            }
            50% {
                transform: scale(1.5) rotate(180deg);
                opacity: 1;
                filter: brightness(2) drop-shadow(0 0 20px gold);
            }
            100% {
                transform: scale(0.2) rotate(360deg);
                opacity: 0;
                filter: brightness(0.5);
            }
        }

        @keyframes levelUpFloat {
            0% {
                transform: translateY(0) scale(0.5) rotate(0deg);
                opacity: 1;
            }
            25% {
                transform: translateY(-50px) scale(1.2) rotate(90deg);
                opacity: 1;
            }
            75% {
                transform: translateY(-150px) scale(1) rotate(270deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-300px) scale(0.3) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes levelUpGlow {
            0%, 100% {
                filter: brightness(1);
            }
            50% {
                filter: brightness(1.5) saturate(1.5);
            }
        }

        @keyframes rainbow {
            0% { filter: hue-rotate(0deg); }
            25% { filter: hue-rotate(90deg); }
            50% { filter: hue-rotate(180deg); }
            75% { filter: hue-rotate(270deg); }
            100% { filter: hue-rotate(360deg); }
        }

        @keyframes powerUpPulse {
            0% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 215, 0, 1), 0 0 30px rgba(255, 215, 0, 0.5); }
            100% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
        }

        /* Enhanced Notification Styles */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            max-width: 350px;
            padding: 15px 20px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            z-index: 10000;
            transform: translateX(400px);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.achievement {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            animation: powerUpPulse 2s ease-in-out infinite;
        }

        .notification.level-up {
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
            animation: levelUpGlow 1s ease-in-out infinite;
        }

        .notification.jackpot {
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 50%, #48dbfb 100%);
            animation: rainbow 2s linear infinite;
        }

        .notification.powerup {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            animation: powerUpPulse 1.5s ease-in-out infinite;
        }

        .notification.spin-result {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* Power-up indicators */
        .power-up-active {
            position: fixed;
            top: 150px;
            left: 20px;
            background: rgba(255, 215, 0, 0.9);
            color: #2c3e50;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            animation: powerUpPulse 2s ease-in-out infinite;
            z-index: 1000;
        }

        /* Enhanced feature panels */
        .feature-active {
            border: 2px solid #f39c12;
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.3);
            animation: powerUpPulse 3s ease-in-out infinite;
        }

        /* Enhanced Shop and Challenge Styles */
        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .shop-item {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .shop-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: rgba(255,255,255,0.4);
        }

        .shop-icon {
            font-size: 40px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
        }

        .shop-details {
            flex: 1;
        }

        .shop-details h4 {
            margin: 0 0 5px 0;
            color: #2c3e50;
            font-size: 16px;
        }

        .shop-details p {
            margin: 0 0 8px 0;
            color: #7f8c8d;
            font-size: 12px;
        }

        .shop-price {
            font-weight: bold;
            color: #8e44ad;
            font-size: 14px;
        }

        .shop-item button {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .shop-item button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
        }

        .shop-item button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Challenge Styles */
        .challenge-item {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(155, 89, 182, 0.1) 100%);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .challenge-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.2);
        }

        .challenge-icon {
            font-size: 30px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #3498db 0%, #9b59b6 100%);
            border-radius: 50%;
            color: white;
        }

        .challenge-details {
            flex: 1;
        }

        .challenge-details h4 {
            margin: 0 0 5px 0;
            color: #2c3e50;
            font-size: 16px;
        }

        .challenge-details p {
            margin: 0 0 10px 0;
            color: #7f8c8d;
            font-size: 12px;
        }

        .challenge-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71 0%, #27ae60 100%);
            transition: width 0.3s ease;
        }

        .challenge-reward {
            font-weight: bold;
            color: #f39c12;
            font-size: 12px;
            text-align: center;
            min-width: 80px;
        }

        /* Achievement completed style */
        .challenge-completed {
            opacity: 0.6;
            border-color: #27ae60;
        }

        .challenge-completed .progress-fill {
            background: linear-gradient(90deg, #27ae60 0%, #2ecc71 100%);
        }

        .prediction-correct {
            background: rgba(46, 204, 113, 0.2);
            border: 2px solid #2ecc71;
            color: #27ae60;
        }

        .prediction-wrong {
            background: rgba(231, 76, 60, 0.2);
            border: 2px solid #e74c3c;
            color: #c0392b;
        }

        /* Connection indicators */
        .feature-connected {
            border: 2px solid #2ecc71;
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.3);
        }

        .feature-active {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(39, 174, 96, 0.1));
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Floating Particles Background -->
    <div class="particles" id="particles"></div>
    
    <!-- Notification System -->
    <div class="notification" id="notification">
        <div id="notificationContent"></div>
    </div>
    
    <button class="menu-button" id="menuButton"><i class="fas fa-bars"></i></button>
    <button class="audio-toggle" id="audioToggle"><i class="fas fa-volume-up"></i></button>
    
    <!-- Theme Selector -->
    <div class="theme-selector" id="themeSelector">
        <button class="theme-close-btn" id="themeCloseBtn" title="Hide theme panel">&times;</button>
        <button class="theme-button theme-normal" id="normalTheme" title="Normal"></button>
        <button class="theme-button theme-dark" id="darkTheme" title="Dark Mode"></button>
        <button class="theme-button theme-rainbow" id="rainbowTheme" title="Rainbow"></button>
        <button class="theme-button theme-neon" id="neonTheme" title="Neon"></button>
        <button class="theme-button theme-3d" id="3dTheme" title="3D Mode"></button>
        <button class="theme-button theme-disco" id="discoTheme" title="Disco"></button>
    </div>
    
    <!-- Theme Show Button (appears when theme selector is hidden) -->
    <button class="theme-show-btn" id="themeShowBtn" title="Show theme panel"></button>
    
    <div class="menu-panel" id="menuPanel">
        <h2>Menu</h2>
        <a class="menu-link" href="https://youtube.com/@yourluckyspin?si=-ye6oqAIu8ZpW1o-" target="_blank" rel="noopener noreferrer" aria-label="Visit our YouTube channel (opens in a new tab)">
            <i class="fab fa-youtube"></i> Subscribe on YouTube
        </a>
        <button id="presetWheelsBtn"><i class="fas fa-star"></i> Preset Wheels</button>
        <button id="customWheelBtn"><i class="fas fa-cog"></i> Custom Wheel</button>
        <button id="savedWheelsBtn"><i class="fas fa-history"></i> Saved Wheels</button>
        
        <h2>Quick Presets</h2>
        <button id="dollarsBtn"><i class="fas fa-money-bill-wave"></i> You Get __ Dollars!</button>
        <button id="countriesBtn"><i class="fas fa-globe"></i> Which Country Will Win</button>
        <button id="birthdayBtn"><i class="fas fa-birthday-cake"></i> Your Birthday Comes You Win</button>
        <button id="foodBtn"><i class="fas fa-utensils"></i> What to Eat Today</button>
        <button id="movieBtn"><i class="fas fa-film"></i> What Movie to Watch</button>
        <button id="colorBtn"><i class="fas fa-palette"></i> Random Color Picker</button>
        <button id="exerciseBtn"><i class="fas fa-running"></i> Daily Exercise</button>
        <button id="bookBtn"><i class="fas fa-book"></i> Next Book to Read</button>
        <button id="travelBtn"><i class="fas fa-plane"></i> Next Vacation Spot</button>
        <button id="gameBtn"><i class="fas fa-gamepad"></i> Game to Play</button>
        <button id="choreBtn"><i class="fas fa-broom"></i> Chore Roulette</button>
        <button id="songBtn"><i class="fas fa-music"></i> Song of the Day</button>
        <button id="drinkBtn"><i class="fas fa-cocktail"></i> Drink Mixer</button>
        <button id="superheroBtn"><i class="fas fa-mask"></i> Superhero Powers</button>
        <button id="fortuneBtn"><i class="fas fa-crystal-ball"></i> Fortune Teller</button>
    </div>
    
    <div class="container">
        <h1><i class="fas fa-redo"></i> Ultimate Spin Wheel</h1>
        <p class="subtitle">Make it yours  ideas, dares, prizes, anything.</p>
        
        <div class="controls-panel">
            <div class="control-group">
                <label for="sliceCount"><i class="fas fa-pizza-slice"></i> Number of Slices:</label>
                <input type="number" id="sliceCount" min="2" max="20" value="6">
            </div>
            
            <div class="control-group">
                <label for="spinSpeed"><i class="fas fa-tachometer-alt"></i> Spin Speed:</label>
                <select id="spinSpeed">
                    <option value="slow">Slow</option>
                    <option value="medium" selected>Medium</option>
                    <option value="fast">Fast</option>
                    <option value="custom">Custom Duration</option>
                </select>
            </div>
            
            <div class="control-group" id="customDurationGroup" style="display: none;">
                <label for="customDuration"><i class="fas fa-clock"></i> Custom Duration (ms):</label>
                <input type="number" id="customDuration" min="1000" max="20000" value="10000">
            </div>
            
            <div class="control-group wheel-name-input">
                <label for="wheelName"><i class="fas fa-tag"></i> Wheel Name:</label>
                <input type="text" id="wheelName" placeholder="Movie Night Roulette">
            </div>
            
            <button id="generateBtn"><i class="fas fa-cog"></i> Generate Wheel</button>
            <button id="spinBtn"><i class="fas fa-sync-alt"></i> Spin the Wheel!</button>
        </div>
        
        <div class="wheel-container" id="wheelContainer">
            <div id="wheel"></div>
            <button class="wheel-info-button" id="wheelInfoBtn">
                WHEEL STATISTICS
            </button>
        </div>
        
        <!-- Enhanced Result Display -->
        <div class="result-display" id="resultDisplay">
            <div class="result-header">
                <i class="fas fa-trophy result-icon"></i>
                <h3> Winner</h3>
            </div>
            <div class="result-content" id="resultContent">
                <div class="result-text">Spin the wheel to see the result!</div>
            </div>
            <div class="result-celebration" id="resultCelebration">
                <div class="celebration-text"> Congratulations! </div>
            </div>
        </div>
        
        <div class="preset-wheels" id="presetWheels">
            <h2><i class="fas fa-star"></i> Preset Wheels</h2>
            <div class="preset-buttons">
                <button id="presetDollarsBtn"><i class="fas fa-money-bill-wave"></i> You Get __ Dollars!</button>
                <button id="presetCountriesBtn"><i class="fas fa-globe"></i> Which Country Will Win</button>
                <button id="presetBirthdayBtn"><i class="fas fa-birthday-cake"></i> Your Birthday Comes You Win</button>
                <button id="presetFoodBtn"><i class="fas fa-utensils"></i> What to Eat Today</button>
                <button id="presetMovieBtn"><i class="fas fa-film"></i> What Movie to Watch</button>
                <button id="presetColorBtn"><i class="fas fa-palette"></i> Random Color Picker</button>
                <button id="presetExerciseBtn"><i class="fas fa-running"></i> Daily Exercise</button>
                <button id="presetBookBtn"><i class="fas fa-book"></i> Next Book to Read</button>
                <button id="presetTravelBtn"><i class="fas fa-plane"></i> Next Vacation Spot</button>
                <button id="presetGameBtn"><i class="fas fa-gamepad"></i> Game to Play</button>
                <button id="presetChoreBtn"><i class="fas fa-broom"></i> Chore Roulette</button>
                <button id="presetSongBtn"><i class="fas fa-music"></i> Song of the Day</button>
                <button id="presetDrinkBtn"><i class="fas fa-cocktail"></i> Drink Mixer</button>
                <button id="presetSuperheroBtn"><i class="fas fa-mask"></i> Superhero Powers</button>
                <button id="presetFortuneBtn"><i class="fas fa-crystal-ball"></i> Fortune Teller</button>
            </div>
        </div>
        
        <div class="slice-config" id="sliceConfig">
            <!-- Slice configuration will be added here -->
        </div>
        
        <div class="save-load-container">
            <textarea id="wheelData" placeholder="Wheel configuration will appear here when generated..."></textarea>
            <div class="save-load-buttons">
                <button id="saveBtn"><i class="fas fa-save"></i> Save Wheel</button>
                <button id="loadBtn"><i class="fas fa-folder-open"></i> Load Wheel</button>
                <button id="copyBtn"><i class="fas fa-copy"></i> Copy to Clipboard</button>
                <div class="file-input-container">
                    <label for="fileInput" class="file-input-label">
                        <i class="fas fa-file-import"></i> Import Text File
                    </label>
                    <input type="file" id="fileInput" class="file-input" accept=".txt,.json">
                </div>
            </div>
        </div>
        
        <!-- Wheel Info Panel -->
        <div class="wheel-info-overlay" id="wheelInfoOverlay"></div>
        <div class="wheel-info-panel" id="wheelInfoPanel">
            <button class="close-info" id="closeInfoBtn">&times;</button>
            <div class="wheel-info-header">
                <h2 id="wheelInfoTitle">Wheel Statistics</h2>
                <p id="wheelInfoName">Current Wheel</p>
            </div>
            
            <div class="wheel-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalSpins">0</div>
                    <div class="stat-label">Total Spins</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalSlices">0</div>
                    <div class="stat-label">Total Slices</div>
                </div>
            </div>
            
            <div class="win-history">
                <div class="win-history-header">
                    <h3>Winning History <span id="historyCount" style="font-size: 14px; font-weight: normal; color: #666;"></span></h3>
                    <button class="win-history-toggle" id="toggleWinHistoryBtn" type="button" title="Show all history" aria-label="Toggle winning history">
                        <i class="fas fa-chevron-down" aria-hidden="true"></i>
                    </button>
                </div>
                <div class="win-list" id="winList">
                    <p style="text-align: center; color: #999;">No spins yet!</p>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px; border-top: 1px solid rgba(0,0,0,0.1); padding-top: 20px;">
                <button id="resetStatsBtn" style="
                    background: linear-gradient(135deg, #ff6b6b, #ee5a52);
                    color: white;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 20px;
                    cursor: pointer;
                    font-weight: bold;
                    font-size: 14px;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 12px rgba(255,107,107,0.3);
                    text-transform: uppercase;
                    letter-spacing: 1px;
                ">
                    <i class="fas fa-trash-alt"></i> Reset All Data
                </button>
            </div>
        </div>
        
        <div class="saved-wheels-container">
            <h2><i class="fas fa-history"></i> Saved Wheels</h2>
            <div class="saved-wheels-list" id="savedWheelsList">
                <!-- Saved wheels will appear here -->
            </div>
        </div>

        <!-- NEW COOL FEATURES -->

        <!-- Wheel Battles -->
        <div class="wheel-battles" id="wheelBattles" style="display: none;">
            <h2><i class="fas fa-fist-raised"></i> Wheel Battle Arena</h2>
            <p>Challenge another wheel to an epic battle!</p>
            <div class="battle-arena">
                <div class="battle-wheel" id="battleWheel1">Player 1</div>
                <div class="vs-text">VS</div>
                <div class="battle-wheel" id="battleWheel2">Player 2</div>
            </div>
            <button id="startBattleBtn" style="background: #e74c3c; border: none; padding: 15px 30px; border-radius: 25px; color: white; font-weight: bold; cursor: pointer;">
                <i class="fas fa-play"></i> Start Battle!
            </button>
        </div>

        <!-- Wheel Casino -->
        <div class="wheel-casino" id="wheelCasino" style="display: none;">
            <h2><i class="fas fa-coins"></i> Wheel Casino</h2>
            <div class="coins-display" id="coinsDisplay"> Coins: 100</div>
            <p>Place your bets and spin to win!</p>
            <div class="casino-chips">
                <div class="chip chip-1" data-value="1">1</div>
                <div class="chip chip-5" data-value="5">5</div>
                <div class="chip chip-10" data-value="10">10</div>
                <div class="chip chip-25" data-value="25">25</div>
                <div class="chip chip-100" data-value="100">100</div>
            </div>
            <div style="margin: 20px 0;">
                <span>Current Bet: </span><span id="currentBet" style="font-weight: bold; color: #f1c40f;">0</span>
            </div>
            <button id="casinoSpinBtn" style="background: #27ae60; border: none; padding: 15px 30px; border-radius: 25px; color: white; font-weight: bold; cursor: pointer;">
                <i class="fas fa-dice"></i> Spin & Win!
            </button>
        </div>

        <!-- Weather Wheel -->
        <div class="weather-wheel" id="weatherWheel" style="display: none;">
            <h2><i class="fas fa-cloud-sun"></i> Weather-Based Wheel</h2>
            <p>Your wheel changes based on today's weather!</p>
            <div class="weather-info">
                <div>
                    <div class="weather-icon" id="weatherIcon"></div>
                    <div id="weatherDesc">Sunny Day</div>
                </div>
                <div>
                    <div style="font-size: 2rem; font-weight: bold;" id="temperature">22C</div>
                    <div>Temperature</div>
                </div>
            </div>
            <button id="updateWeatherBtn" style="background: rgba(255,255,255,0.2); border: none; padding: 10px 20px; border-radius: 20px; color: white; cursor: pointer;">
                <i class="fas fa-sync-alt"></i> Update Weather
            </button>
        </div>

        <!-- Multiplayer Lobby -->
        <div class="multiplayer-lobby" id="multiplayerLobby" style="display: none;">
            <h2><i class="fas fa-users"></i> Multiplayer Lobby</h2>
            <p>Join friends and spin together!</p>
            <div class="player-list" id="playerList">
                <div class="player-card">
                    <div class="player-avatar"></div>
                    <div style="font-weight: bold;">Player 1</div>
                    <div style="font-size: 0.9rem; opacity: 0.8;">Online</div>
                </div>
                <div class="player-card">
                    <div class="player-avatar"></div>
                    <div style="font-weight: bold;">Player 2</div>
                    <div style="font-size: 0.9rem; opacity: 0.8;">Online</div>
                </div>
            </div>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button id="createRoomBtn" style="background: #27ae60; border: none; padding: 10px 20px; border-radius: 20px; color: white; cursor: pointer;">
                    <i class="fas fa-plus"></i> Create Room
                </button>
                <button id="joinRoomBtn" style="background: #3498db; border: none; padding: 10px 20px; border-radius: 20px; color: white; cursor: pointer;">
                    <i class="fas fa-sign-in-alt"></i> Join Room
                </button>
            </div>
        </div>

        <!-- Social Sharing Panel -->
        <div class="social-panel" id="socialPanel" style="display: none;">
            <h2><i class="fas fa-share"></i> Share Your Results</h2>
            <p>Share your epic wheel spins with the world!</p>
            <div class="share-buttons">
                <button class="share-btn share-twitter" id="shareTwitter">
                    <i class="fab fa-twitter"></i> Twitter
                </button>
                <button class="share-btn share-facebook" id="shareFacebook">
                    <i class="fab fa-facebook"></i> Facebook
                </button>
                <button class="share-btn share-instagram" id="shareInstagram">
                    <i class="fab fa-instagram"></i> Instagram
                </button>
                <button class="share-btn share-tiktok" id="shareTiktok">
                    <i class="fab fa-tiktok"></i> TikTok
                </button>
            </div>
            <div style="margin-top: 20px;">
                <label style="display: block; margin-bottom: 10px;">Share Message:</label>
                <textarea id="shareMessage" style="width: 100%; padding: 10px; border: none; border-radius: 8px; background: rgba(255,255,255,0.8);" placeholder="Just spun the wheel and got..."> Just spun the Ultimate Wheel and got something amazing! </textarea>
            </div>
        </div>

        <!-- Mini Games -->
        <div class="mini-games" id="miniGames" style="display: none;">
            <h2><i class="fas fa-gamepad"></i> Mini Games</h2>
            <p>Play quick games while waiting to spin!</p>
            <div class="game-grid">
                <button class="mini-game-btn" id="guessNumberGame">
                    <i class="fas fa-question"></i><br>Guess the Number
                </button>
                <button class="mini-game-btn" id="memoryGame">
                    <i class="fas fa-brain"></i><br>Memory Game
                </button>
                <button class="mini-game-btn" id="reactionGame">
                    <i class="fas fa-stopwatch"></i><br>Reaction Test
                </button>
                <button class="mini-game-btn" id="mathQuizGame">
                    <i class="fas fa-calculator"></i><br>Math Quiz
                </button>
                <button class="mini-game-btn" id="colorMatchGame">
                    <i class="fas fa-palette"></i><br>Color Match
                </button>
                <button class="mini-game-btn" id="trivia Game">
                    <i class="fas fa-question-circle"></i><br>Trivia
                </button>
            </div>
        </div>

        <!-- Voice Control -->
        <div class="voice-control" id="voiceControl" style="display: none;">
            <h2><i class="fas fa-microphone"></i> Voice Commands</h2>
            <p>Control the wheel with your voice!</p>
            <button class="mic-button" id="micButton">
                <i class="fas fa-microphone"></i>
            </button>
            <div id="voiceStatus">Say "Spin the wheel" or "Generate wheel"</div>
            <div style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">
                Commands: "Spin", "Generate", "Stop", "Reset", "Save wheel"
            </div>
        </div>

        <!-- Background Selector -->
        <div class="background-selector" id="backgroundSelector" style="display: none;">
            <h2><i class="fas fa-image"></i> Custom Backgrounds</h2>
            <div class="bg-grid">
                <div class="bg-option bg-space" data-bg="space" title="Space Theme"></div>
                <div class="bg-option bg-ocean active" data-bg="ocean" title="Ocean Theme"></div>
                <div class="bg-option bg-sunset" data-bg="sunset" title="Sunset Theme"></div>
                <div class="bg-option bg-forest" data-bg="forest" title="Forest Theme"></div>
            </div>
        </div>

        <!-- Leaderboard -->
        <div class="leaderboard" id="leaderboard" style="display: none;">
            <h2><i class="fas fa-trophy"></i> Global Leaderboard</h2>
            <div id="leaderboardList">
                <div class="leaderboard-item">
                    <span class="rank-medal"></span>
                    <span class="player-name">SpinMaster2024</span>
                    <span class="player-score">1,337 pts</span>
                </div>
                <div class="leaderboard-item">
                    <span class="rank-medal"></span>
                    <span class="player-name">WheelWarrior</span>
                    <span class="player-score">1,205 pts</span>
                </div>
                <div class="leaderboard-item">
                    <span class="rank-medal"></span>
                    <span class="player-name">LuckySpinner</span>
                    <span class="player-score">987 pts</span>
                </div>
                <div class="leaderboard-item">
                    <span class="rank-medal">4</span>
                    <span class="player-name">You</span>
                    <span class="player-score">156 pts</span>
                </div>
            </div>
        </div>

        <!-- Wheel Customizer -->
        <div class="wheel-customizer" id="wheelCustomizer" style="display: none;">
            <h2><i class="fas fa-magic"></i> Advanced Wheel Designer</h2>
            <div class="customizer-section">
                <h3>Colors</h3>
                <div class="color-picker-grid">
                    <div class="color-picker" style="background: #ff6b6b;" data-color="#ff6b6b"></div>
                    <div class="color-picker" style="background: #4ecdc4;" data-color="#4ecdc4"></div>
                    <div class="color-picker" style="background: #45b7d1;" data-color="#45b7d1"></div>
                    <div class="color-picker" style="background: #96ceb4;" data-color="#96ceb4"></div>
                    <div class="color-picker" style="background: #feca57;" data-color="#feca57"></div>
                    <div class="color-picker" style="background: #ff9ff3;" data-color="#ff9ff3"></div>
                    <div class="color-picker" style="background: #54a0ff;" data-color="#54a0ff"></div>
                    <div class="color-picker" style="background: #5f27cd;" data-color="#5f27cd"></div>
                </div>
            </div>
            <div class="customizer-section">
                <h3>Design Tools</h3>
                <div class="design-tools">
                    <button class="design-tool" id="gradientMode">
                        <i class="fas fa-fill-drip"></i><br>Gradient Mode
                    </button>
                    <button class="design-tool" id="patternMode">
                        <i class="fas fa-th"></i><br>Pattern Mode
                    </button>
                    <button class="design-tool" id="imageMode">
                        <i class="fas fa-image"></i><br>Image Mode
                    </button>
                    <button class="design-tool" id="neonMode">
                        <i class="fas fa-lightbulb"></i><br>Neon Effect
                    </button>
                </div>
            </div>
        </div>

        <!-- Slot Machine -->
        <div class="slot-machine" id="slotMachine" style="display: none;">
            <h2><i class="fas fa-star"></i> Lucky Slot Machine</h2>
            <p>Spin the slots before spinning the wheel for extra luck!</p>
            <div class="slot-reels">
                <div class="slot-reel">
                    <div class="slot-symbols" id="slot1">
                        <div class="slot-symbol"></div>
                    </div>
                </div>
                <div class="slot-reel">
                    <div class="slot-symbols" id="slot2">
                        <div class="slot-symbol"></div>
                    </div>
                </div>
                <div class="slot-reel">
                    <div class="slot-symbols" id="slot3">
                        <div class="slot-symbol"></div>
                    </div>
                </div>
            </div>
            <button id="slotSpinBtn" style="background: #f1c40f; border: none; padding: 15px 30px; border-radius: 25px; color: #2c3e50; font-weight: bold; cursor: pointer;">
                <i class="fas fa-coins"></i> Spin Slots!
            </button>
            <div id="slotResult" style="margin-top: 15px; font-weight: bold;"></div>
        </div>

        <!-- Prediction Mode -->
        <div class="prediction-mode" id="predictionMode" style="display: none;">
            <h2><i class="fas fa-crystal-ball"></i> Prediction Challenge</h2>
            <p>Try to predict what the wheel will land on!</p>
            <input type="text" class="prediction-input" id="predictionInput" placeholder="Enter your prediction...">
            <div id="predictionFeedback" class="prediction-feedback" style="display: none;"></div>
            <div style="margin: 15px 0;">
                <span>Correct Predictions: </span><span id="correctPredictions" style="font-weight: bold;">0</span>
                <span style="margin-left: 20px;">Total Attempts: </span><span id="totalPredictions" style="font-weight: bold;">0</span>
            </div>
            <div style="margin: 10px 0;">
                <span>Accuracy: </span><span id="predictionAccuracy" style="font-weight: bold; color: #f1c40f;">0%</span>
            </div>
        </div>

        <!-- Reality Check -->
        <div class="reality-check" id="realityCheck" style="display: none;">
            <h2><i class="fas fa-clock"></i> Take a Break Reminder</h2>
            <p>You've been spinning for a while! Consider taking a break.</p>
            <div class="reality-timer" id="sessionTimer">00:00:00</div>
            <div style="margin: 15px 0;">
                <button id="continueBtn" style="background: rgba(255,255,255,0.2); border: none; padding: 10px 20px; border-radius: 20px; color: white; cursor: pointer; margin: 0 10px;">
                    Continue Playing
                </button>
                <button id="takeBreakBtn" style="background: rgba(255,255,255,0.2); border: none; padding: 10px 20px; border-radius: 20px; color: white; cursor: pointer; margin: 0 10px;">
                    Take a Break
                </button>
            </div>
        </div>

        <!-- Tournament Bracket -->
        <div class="tournament-bracket" id="tournamentBracket" style="display: none;">
            <h2><i class="fas fa-trophy"></i> Wheel Tournament</h2>
            <div class="bracket-round">
                <div class="bracket-match">
                    <div>Option A vs Option B</div>
                    <button style="background: #27ae60; border: none; padding: 5px 10px; border-radius: 15px; color: white; margin-top: 10px; cursor: pointer;">Spin</button>
                </div>
                <div class="bracket-match">
                    <div>Option C vs Option D</div>
                    <button style="background: #27ae60; border: none; padding: 5px 10px; border-radius: 15px; color: white; margin-top: 10px; cursor: pointer;">Spin</button>
                </div>
            </div>
        </div>

        <!-- Karma System -->
        <div class="karma-display" id="karmaDisplay" style="display: none;">
            <h2><i class="fas fa-yin-yang"></i> Wheel Karma</h2>
            <p>Your spinning karma affects your luck!</p>
            <div class="karma-bar">
                <div class="karma-fill" id="karmaFill" style="width: 60%;"></div>
            </div>
            <div style="margin: 15px 0;">
                <span>Karma Level: </span><span id="karmaLevel" style="font-weight: bold; color: #f1c40f;">Good</span>
            </div>
            <div style="font-size: 0.9rem; opacity: 0.8;">
                Positive actions increase karma, negative actions decrease it.
            </div>
        </div>

        <!-- Secret Achievement -->
        <div class="secret-achievement" id="secretAchievement" style="display: none;">
            <div class="secret-content">
                <h2><i class="fas fa-user-secret"></i> Secret Discovery</h2>
                <p>You've unlocked a hidden feature!</p>
                <div style="font-size: 2rem; margin: 20px 0;"></div>
                <div style="margin: 15px 0;">
                    <button id="secretBtn" style="background: rgba(255,255,255,0.2); border: none; padding: 12px 25px; border-radius: 25px; color: white; cursor: pointer; font-weight: bold;">
                        Activate Secret Mode
                    </button>
                </div>
            </div>
        </div>

        <!-- Enhanced Power-Up Shop -->
        <div id="powerUpShop" class="feature-panel" style="display: none;">
            <h3> Power-Up Shop</h3>
            <div class="shop-grid">
                <div class="shop-item">
                    <div class="shop-icon"></div>
                    <div class="shop-details">
                        <h4>Lucky Charm</h4>
                        <p>+20% casino win chance for 10 min</p>
                        <div class="shop-price"> 10</div>
                    </div>
                    <button onclick="buyPowerUp('luckyCharm', 10)">Buy</button>
                </div>
                <div class="shop-item">
                    <div class="shop-icon"></div>
                    <div class="shop-details">
                        <h4>Double XP</h4>
                        <p>2x XP gain for 5 minutes</p>
                        <div class="shop-price"> 8</div>
                    </div>
                    <button onclick="buyPowerUp('doubleXP', 8)">Buy</button>
                </div>
                <div class="shop-item">
                    <div class="shop-icon"></div>
                    <div class="shop-details">
                        <h4>Coin Boost</h4>
                        <p>+50% coin rewards for 5 min</p>
                        <div class="shop-price"> 8</div>
                    </div>
                    <button onclick="buyPowerUp('coinBoost', 8)">Buy</button>
                </div>
                <div class="shop-item">
                    <div class="shop-icon"></div>
                    <div class="shop-details">
                        <h4>Gem Finder</h4>
                        <p>4x gem drop chance for 10 min</p>
                        <div class="shop-price"> 15</div>
                    </div>
                    <button onclick="buyPowerUp('gemFinder', 15)">Buy</button>
                </div>
            </div>
            <button onclick="hidePanel('powerUpShop')" class="close-btn">Close</button>
        </div>

        <!-- Daily Challenges Panel -->
        <div id="dailyChallenges" class="feature-panel" style="display: none;">
            <h3> Daily Challenges</h3>
            <div id="challengesList">
                <div class="challenge-item">
                    <div class="challenge-icon"></div>
                    <div class="challenge-details">
                        <h4>Spin Master</h4>
                        <p>Complete 20 spins today</p>
                        <div class="challenge-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="spinProgress" style="width: 0%"></div>
                            </div>
                            <span id="spinProgressText">0/20</span>
                        </div>
                    </div>
                    <div class="challenge-reward"> 100 +  5</div>
                </div>
                <div class="challenge-item">
                    <div class="challenge-icon"></div>
                    <div class="challenge-details">
                        <h4>Perfect Predictor</h4>
                        <p>Make 5 correct predictions</p>
                        <div class="challenge-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="predictionProgress" style="width: 0%"></div>
                            </div>
                            <span id="predictionProgressText">0/5</span>
                        </div>
                    </div>
                    <div class="challenge-reward"> 150 +  Double XP</div>
                </div>
                <div class="challenge-item">
                    <div class="challenge-icon"></div>
                    <div class="challenge-details">
                        <h4>High Roller</h4>
                        <p>Win 500 coins from casino today</p>
                        <div class="challenge-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="casinoProgress" style="width: 0%"></div>
                            </div>
                            <span id="casinoProgressText">0/500</span>
                        </div>
                    </div>
                    <div class="challenge-reward"> 20 +  Lucky Charm</div>
                </div>
            </div>
            <button onclick="hidePanel('dailyChallenges')" class="close-btn">Close</button>
        </div>
    </div>
    
    <!-- Sound effects with reliable sources -->
    <audio id="spinSound" preload="auto">
        <source src="wheelspin.mp3" type="audio/mpeg">
    </audio>
    <audio id="winSound" preload="auto">
        <source src="winsound.mp3" type="audio/mpeg">
    </audio>
    <audio id="tickSound" preload="auto">
        <source src="ticksound.mp3" type="audio/mpeg">
    </audio>
    <audio id="confettiSound" preload="auto">
        <source src="confettisound.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Particle System
        function createParticles() {
            const particles = document.getElementById('particles');
            
            function createParticle() {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Random size
                const size = Math.random() * 4 + 2;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                // Random position
                particle.style.left = Math.random() * 100 + '%';
                
                // Random animation duration
                const duration = Math.random() * 15 + 10;
                particle.style.animationDuration = duration + 's';
                
                // Random delay
                particle.style.animationDelay = Math.random() * 2 + 's';
                
                particles.appendChild(particle);
                
                // Remove particle after animation
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, (duration + 2) * 1000);
            }
            
            // Create initial particles
            for (let i = 0; i < 20; i++) {
                setTimeout(createParticle, i * 200);
            }
            
            // Continuously create particles
            setInterval(createParticle, 500);
        }
        
        // Fireworks effect
        function createFireworks(x, y) {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff'];
            
            for (let i = 0; i < 12; i++) {
                const firework = document.createElement('div');
                firework.style.position = 'absolute';
                firework.style.left = x + 'px';
                firework.style.top = y + 'px';
                firework.style.width = '4px';
                firework.style.height = '4px';
                firework.style.background = colors[Math.floor(Math.random() * colors.length)];
                firework.style.borderRadius = '50%';
                firework.style.pointerEvents = 'none';
                firework.style.zIndex = '1000';
                
                const angle = (i * 30) * Math.PI / 180;
                const velocity = Math.random() * 100 + 50;
                const vx = Math.cos(angle) * velocity;
                const vy = Math.sin(angle) * velocity;
                
                firework.style.animation = `fireworkFly 1s ease-out forwards`;
                firework.style.setProperty('--vx', vx + 'px');
                firework.style.setProperty('--vy', vy + 'px');
                
                document.body.appendChild(firework);
                
                setTimeout(() => {
                    if (firework.parentNode) {
                        firework.parentNode.removeChild(firework);
                    }
                }, 1000);
            }
        }
        
        // Add firework animation CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fireworkFly {
                to {
                    transform: translate(var(--vx), var(--vy));
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded - Initializing wheel...');
            // Initialize particle system
            createParticles();
            // DOM elements
            const wheel = document.getElementById('wheel');
            const wheelContainer = document.getElementById('wheelContainer');
            const sliceCountInput = document.getElementById('sliceCount');
            const generateBtn = document.getElementById('generateBtn');
            const spinBtn = document.getElementById('spinBtn');
            const sliceConfig = document.getElementById('sliceConfig');
            const resultDisplay = document.getElementById('resultDisplay');
            const resultContent = document.getElementById('resultContent');
            const resultCelebration = document.getElementById('resultCelebration');
            const spinSound = document.getElementById('spinSound');
            const winSound = document.getElementById('winSound');
            const tickSound = document.getElementById('tickSound');
            const confettiSound = document.getElementById('confettiSound');
            const spinSpeedSelect = document.getElementById('spinSpeed');
            const customDurationGroup = document.getElementById('customDurationGroup');
            const customDurationInput = document.getElementById('customDuration');
            const wheelDataTextarea = document.getElementById('wheelData');
            const saveBtn = document.getElementById('saveBtn');
            const loadBtn = document.getElementById('loadBtn');
            const copyBtn = document.getElementById('copyBtn');
            const wheelNameInput = document.getElementById('wheelName');
            const savedWheelsList = document.getElementById('savedWheelsList');
            const fileInput = document.getElementById('fileInput');
            const menuButton = document.getElementById('menuButton');
            const menuPanel = document.getElementById('menuPanel');
            const audioToggle = document.getElementById('audioToggle');
            const presetWheelsSection = document.getElementById('presetWheels');
            
            // Wheel info panel elements
            const wheelInfoBtn = document.getElementById('wheelInfoBtn');
            const wheelInfoPanel = document.getElementById('wheelInfoPanel');
            const wheelInfoOverlay = document.getElementById('wheelInfoOverlay');
            const closeInfoBtn = document.getElementById('closeInfoBtn');
            const resetStatsBtn = document.getElementById('resetStatsBtn');
            
            // Theme elements
            const themeSelector = document.getElementById('themeSelector');
            const themeCloseBtn = document.getElementById('themeCloseBtn');
            const themeShowBtn = document.getElementById('themeShowBtn');
            const normalTheme = document.getElementById('normalTheme');
            const darkTheme = document.getElementById('darkTheme');
            const rainbowTheme = document.getElementById('rainbowTheme');
            const neonTheme = document.getElementById('neonTheme');
            const theme3d = document.getElementById('3dTheme');
            const discoTheme = document.getElementById('discoTheme');
            
            // Menu buttons
            const presetWheelsBtn = document.getElementById('presetWheelsBtn');
            const customWheelBtn = document.getElementById('customWheelBtn');
            const savedWheelsBtn = document.getElementById('savedWheelsBtn');
            
            // Preset wheel buttons (menu)
            const dollarsBtn = document.getElementById('dollarsBtn');
            const countriesBtn = document.getElementById('countriesBtn');
            const birthdayBtn = document.getElementById('birthdayBtn');
            const foodBtn = document.getElementById('foodBtn');
            const movieBtn = document.getElementById('movieBtn');
            const colorBtn = document.getElementById('colorBtn');
            const exerciseBtn = document.getElementById('exerciseBtn');
            const bookBtn = document.getElementById('bookBtn');
            const travelBtn = document.getElementById('travelBtn');
            const gameBtn = document.getElementById('gameBtn');
            const choreBtn = document.getElementById('choreBtn');
            const songBtn = document.getElementById('songBtn');
            const drinkBtn = document.getElementById('drinkBtn');
            const superheroBtn = document.getElementById('superheroBtn');
            const fortuneBtn = document.getElementById('fortuneBtn');
            
            // Preset wheel buttons (main section)
            const presetDollarsBtn = document.getElementById('presetDollarsBtn');
            const presetCountriesBtn = document.getElementById('presetCountriesBtn');
            const presetBirthdayBtn = document.getElementById('presetBirthdayBtn');
            const presetFoodBtn = document.getElementById('presetFoodBtn');
            const presetMovieBtn = document.getElementById('presetMovieBtn');
            const presetColorBtn = document.getElementById('presetColorBtn');
            const presetExerciseBtn = document.getElementById('presetExerciseBtn');
            const presetBookBtn = document.getElementById('presetBookBtn');
            const presetTravelBtn = document.getElementById('presetTravelBtn');
            const presetGameBtn = document.getElementById('presetGameBtn');
            const presetChoreBtn = document.getElementById('presetChoreBtn');
            const presetSongBtn = document.getElementById('presetSongBtn');
            const presetDrinkBtn = document.getElementById('presetDrinkBtn');
            const presetSuperheroBtn = document.getElementById('presetSuperheroBtn');
            const presetFortuneBtn = document.getElementById('presetFortuneBtn');
            
            // Wheel state
            let slices = [];
            let isSpinning = false;
            let currentRotation = 0;
            let tickInterval;
            let confettiInterval;
            let slowDownInterval;
            let audioEnabled = false;
            let audioMuted = false;
            let wheelStats = {totalSpins: 0, winHistory: [], wheelName: 'Custom Wheel'};
            let winHistoryExpanded = false;

            // Subtle 3D tilt on the wheel to feel more playful/creative.
            // Disabled while spinning and for reduced-motion users.
            const prefersReducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            if (!prefersReducedMotion && wheelContainer) {
                let tiltRaf = null;

                const resetTilt = () => {
                    if (isSpinning) return;
                    wheelContainer.style.transform = '';
                };

                const handleTilt = (event) => {
                    if (isSpinning) return;
                    const rect = wheelContainer.getBoundingClientRect();
                    const x = (event.clientX - rect.left) / rect.width - 0.5;
                    const y = (event.clientY - rect.top) / rect.height - 0.5;

                    const rotateY = x * 10;
                    const rotateX = -y * 10;

                    wheelContainer.style.transform = `rotateX(${rotateX.toFixed(2)}deg) rotateY(${rotateY.toFixed(2)}deg) scale(1.02)`;
                };

                wheelContainer.addEventListener('mousemove', (event) => {
                    if (tiltRaf) cancelAnimationFrame(tiltRaf);
                    tiltRaf = requestAnimationFrame(() => handleTilt(event));
                });
                wheelContainer.addEventListener('mouseleave', resetTilt);
                wheelContainer.addEventListener('blur', resetTilt);
            }
            
            // Enhanced color palette with better contrast between adjacent colors
            const colorPalette = [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', 
                '#FF9F40', '#8AC24A', '#F06292', '#7986CB', '#E57373',
                '#64B5F6', '#BA68C8', '#4DB6AC', '#81C784', '#FFD54F',
                '#FF8A65', '#A1887F', '#90A4AE', '#9575CD', '#4FC3F7',
                '#FF5252', '#448AFF', '#FFAB40', '#69F0AE', '#7C4DFF',
                '#FF4081', '#40C4FF', '#FFD740', '#B2FF59', '#E040FB',
                '#D50000', '#2962FF', '#FF6D00', '#00C853', '#AA00FF',
                '#C51162', '#00B8D4', '#FFAB00', '#64DD17', '#6200EA',
                '#FF1744', '#3D5AFE', '#FF9100', '#00E676', '#651FFF',
                '#F50057', '#304FFE', '#FF6D00', '#00BFA5', '#7C4DFF',
                '#D500F9', '#2979FF', '#FF3D00', '#1DE9B6', '#6200EA',
                '#FF80AB', '#80D8FF', '#FF9E80', '#B9F6CA', '#B388FF'
            ];
            
            // Function to get distinct colors for adjacent slices
            function getDistinctColor(index, previousColor) {
                let attempts = 0;
                let color;
                
                do {
                    color = colorPalette[(index + attempts) % colorPalette.length];
                    attempts++;
                    
                    // Ensure we don't get stuck in infinite loop
                    if (attempts > colorPalette.length) {
                        return colorPalette[index % colorPalette.length];
                    }
                    
                    // Convert colors to RGB for comparison
                    const hexToRgb = (hex) => {
                        const r = parseInt(hex.slice(1, 3), 16);
                        const g = parseInt(hex.slice(3, 5), 16);
                        const b = parseInt(hex.slice(5, 7), 16);
                        return [r, g, b];
                    };
                    
                    if (!previousColor) break;
                    
                    const [r1, g1, b1] = hexToRgb(color);
                    const [r2, g2, b2] = hexToRgb(previousColor);
                    
                    // Calculate color difference (simple Euclidean distance)
                    const diff = Math.sqrt(
                        Math.pow(r1 - r2, 2) + 
                        Math.pow(g1 - g2, 2) + 
                        Math.pow(b1 - b2, 2)
                    );
                    
                    // If colors are sufficiently different, use this color
                    if (diff > 150) break;
                    
                } while (true);
                
                return color;
            }
            
            // Preset wheel data
            const presetWheels = {
                dollars: {
                    name: "You Get __ Dollars!",
                    items: [
                        "$1,000,000", "$500,000", "$250,000", "$100,000", "$50,000",
                        "$25,000", "$10,000", "$5,000", "$2,500", "$1,000",
                        "$500", "$250", "$100", "$50", "$25",
                        "$10", "$5", "$1","-$1", "-$5", "-$10", "-$25", "-$50",
                        "-$100", "-$250", "-$500", "-$1,000", "-$2,500",
                        "-$5,000", "-$10,000", "-$25,000", "-$50,000", "-$100,000",
                        "-$250,000", "-$500,000", "-$1,000,000"
                    ],
                    colors: [
                        "#00b894", "#00b894", "#00b894", "#00b894", "#00b894",
                        "#00b894", "#00b894", "#00b894", "#00b894", "#00b894",
                        "#00b894", "#00b894", "#00b894", "#00b894", "#00b894",
                        "#00b894", "#00b894", "#00b894", 
                        "#d63031", "#d63031", "#d63031", "#d63031", "#d63031",
                        "#d63031", "#d63031", "#d63031", "#d63031", "#d63031",
                        "#d63031", "#d63031", "#d63031", "#d63031", "#d63031",
                        "#d63031", "#d63031", "#d63031"
                    ]
                },
                countries: {
                    name: "Which Country Will Win",
                    items: [
                        "Afghanistan ", "Albania ", "Algeria ", "Andorra ", "Angola ",
            "Antigua and Barbuda ", "Argentina ", "Armenia ", "Australia ", "Austria ",
            "Azerbaijan ", "Bahamas ", "Bahrain ", "Bangladesh ", "Barbados ",
            "Belarus ", "Belgium ", "Belize ", "Benin ", "Bhutan ",
            "Bolivia ", "Bosnia and Herzegovina ", "Botswana ", "Brazil ", "Brunei ",
            "Bulgaria ", "Burkina Faso ", "Burundi ", "Cambodia ", "Cameroon ",
            "Canada ", "Cape Verde ", "Central African Republic ", "Chad ", "Chile ",
            "China ", "Colombia ", "Comoros ", "Republic of the Congo ", "DR Congo ",
            "Costa Rica ", "Cte d'Ivoire ", "Croatia ", "Cuba ", "Cyprus ",
            "Czechia ", "Denmark ", "Djibouti ", "Dominica ", "Dominican Republic ",
            "Ecuador ", "Egypt ", "El Salvador ", "Equatorial Guinea ", "Eritrea ",
            "Estonia ", "Eswatini ", "Ethiopia ", "Fiji ", "Finland ",
            "France ", "Gabon ", "Gambia ", "Georgia ", "Germany ",
            "Ghana ", "Greece ", "Grenada ", "Guatemala ", "Guinea ",
            "Guinea-Bissau ", "Guyana ", "Haiti ", "Honduras ", "Hungary ",
            "Iceland ", "India ", "Indonesia ", "Iran ", "Iraq ",
            "Ireland ", "Israel ", "Italy ", "Jamaica ", "Japan ",
            "Jordan ", "Kazakhstan ", "Kenya ", "Kiribati ", "North Korea ",
            "South Korea ", "Kosovo ", "Kuwait ", "Kyrgyzstan ", "Laos ",
            "Latvia ", "Lebanon ", "Lesotho ", "Liberia ", "Libya ",
            "Liechtenstein ", "Lithuania ", "Luxembourg ", "Madagascar ", "Malawi ",
            "Malaysia ", "Maldives ", "Mali ", "Malta ", "Marshall Islands ",
            "Mauritania ", "Mauritius ", "Mexico ", "Micronesia ", "Moldova ",
            "Monaco ", "Mongolia ", "Montenegro ", "Morocco ", "Mozambique ",
            "Myanmar ", "Namibia ", "Nauru ", "Nepal ", "Netherlands ",
            "New Zealand ", "Nicaragua ", "Niger ", "Nigeria ", "North Macedonia ",
            "Norway ", "Oman ", "Pakistan ", "Palau ", "Palestine ",
            "Panama ", "Papua New Guinea ", "Paraguay ", "Peru ", "Philippines ",
            "Poland ", "Portugal ", "Qatar ", "Romania ", "Russia ",
            "Rwanda ", "Saint Kitts and Nevis ", "Saint Lucia ", "Samoa ", "San Marino ",
            "Sao Tome and Principe ", "Saudi Arabia ", "Senegal ", "Serbia ", "Seychelles ",
            "Sierra Leone ", "Singapore ", "Slovakia ", "Slovenia ", "Solomon Islands ",
            "Somalia ", "South Africa ", "South Sudan ", "Spain ", "Sri Lanka ",
            "Sudan ", "Suriname ", "Sweden ", "Switzerland ", "Syria ",
            "Taiwan ", "Tajikistan ", "Tanzania ", "Thailand ", "Timor-Leste ",
            "Togo ", "Tonga ", "Trinidad and Tobago ", "Tunisia ", "Turkey ",
            "Turkmenistan ", "Tuvalu ", "Uganda ", "Ukraine ", "United Arab Emirates ",
            "United Kingdom ", "United States ", "Uruguay ", "Uzbekistan ", "Vanuatu ",
            "Vatican City ", "Venezuela ", "Vietnam ", "Yemen ", "Zambia ", "Zimbabwe "               ]
                },
                birthday: {
                    name: "Your Birthday Comes You Win",
                    items: [
                        "Jan 1", "Jan 2", "Jan 3", "Jan 4", "Jan 5", "Jan 6", "Jan 7", "Jan 8", "Jan 9", "Jan 10", "Jan 11", "Jan 12", "Jan 13", "Jan 14", "Jan 15", "Jan 16", "Jan 17", "Jan 18", "Jan 19", "Jan 20", "Jan 21", "Jan 22", "Jan 23", "Jan 24", "Jan 25", "Jan 26", "Jan 27", "Jan 28", "Jan 29", "Jan 30", "Jan 31", "Feb 1", "Feb 2", "Feb 3", "Feb 4", "Feb 5", "Feb 6", "Feb 7", "Feb 8", "Feb 9", "Feb 10", "Feb 11", "Feb 12", "Feb 13", "Feb 14", "Feb 15", "Feb 16", "Feb 17", "Feb 18", "Feb 19", "Feb 20", "Feb 21", "Feb 22", "Feb 23", "Feb 24", "Feb 25", "Feb 26", "Feb 27", "Feb 28", "Feb 29", "Mar 1", "Mar 2", "Mar 3", "Mar 4", "Mar 5", "Mar 6", "Mar 7", "Mar 8", "Mar 9", "Mar 10", "Mar 11", "Mar 12", "Mar 13", "Mar 14", "Mar 15", "Mar 16", "Mar 17", "Mar 18", "Mar 19", "Mar 20", "Mar 21", "Mar 22", "Mar 23", "Mar 24", "Mar 25", "Mar 26", "Mar 27", "Mar 28", "Mar 29", "Mar 30", "Mar 31", "Apr 1", "Apr 2", "Apr 3", "Apr 4", "Apr 5", "Apr 6", "Apr 7", "Apr 8", "Apr 9", "Apr 10", "Apr 11", "Apr 12", "Apr 13", "Apr 14", "Apr 15", "Apr 16", "Apr 17", "Apr 18", "Apr 19", "Apr 20", "Apr 21", "Apr 22", "Apr 23", "Apr 24", "Apr 25", "Apr 26", "Apr 27", "Apr 28", "Apr 29", "Apr 30", "May 1", "May 2", "May 3", "May 4", "May 5", "May 6", "May 7", "May 8", "May 9", "May 10", "May 11", "May 12", "May 13", "May 14", "May 15", "May 16", "May 17", "May 18", "May 19", "May 20", "May 21", "May 22", "May 23", "May 24", "May 25", "May 26", "May 27", "May 28", "May 29", "May 30", "May 31", "Jun 1", "Jun 2", "Jun 3", "Jun 4", "Jun 5", "Jun 6", "Jun 7", "Jun 8", "Jun 9", "Jun 10", "Jun 11", "Jun 12", "Jun 13", "Jun 14", "Jun 15", "Jun 16", "Jun 17", "Jun 18", "Jun 19", "Jun 20", "Jun 21", "Jun 22", "Jun 23", "Jun 24", "Jun 25", "Jun 26", "Jun 27", "Jun 28", "Jun 29", "Jun 30", "Jul 1", "Jul 2", "Jul 3", "Jul 4", "Jul 5", "Jul 6", "Jul 7", "Jul 8", "Jul 9", "Jul 10", "Jul 11", "Jul 12", "Jul 13", "Jul 14", "Jul 15", "Jul 16", "Jul 17", "Jul 18", "Jul 19", "Jul 20", "Jul 21", "Jul 22", "Jul 23", "Jul 24", "Jul 25", "Jul 26", "Jul 27", "Jul 28", "Jul 29", "Jul 30", "Jul 31", "Aug 1", "Aug 2", "Aug 3", "Aug 4", "Aug 5", "Aug 6", "Aug 7", "Aug 8", "Aug 9", "Aug 10", "Aug 11", "Aug 12", "Aug 13", "Aug 14", "Aug 15", "Aug 16", "Aug 17", "Aug 18", "Aug 19", "Aug 20", "Aug 21", "Aug 22", "Aug 23", "Aug 24", "Aug 25", "Aug 26", "Aug 27", "Aug 28", "Aug 29", "Aug 30", "Aug 31", "Sep 1", "Sep 2", "Sep 3", "Sep 4", "Sep 5", "Sep 6", "Sep 7", "Sep 8", "Sep 9", "Sep 10", "Sep 11", "Sep 12", "Sep 13", "Sep 14", "Sep 15", "Sep 16", "Sep 17", "Sep 18", "Sep 19", "Sep 20", "Sep 21", "Sep 22", "Sep 23", "Sep 24", "Sep 25", "Sep 26", "Sep 27", "Sep 28", "Sep 29", "Sep 30", "Oct 1", "Oct 2", "Oct 3", "Oct 4", "Oct 5", "Oct 6", "Oct 7", "Oct 8", "Oct 9", "Oct 10", "Oct 11", "Oct 12", "Oct 13", "Oct 14", "Oct 15", "Oct 16", "Oct 17", "Oct 18", "Oct 19", "Oct 20", "Oct 21", "Oct 22", "Oct 23", "Oct 24", "Oct 25", "Oct 26", "Oct 27", "Oct 28", "Oct 29", "Oct 30", "Oct 31", "Nov 1", "Nov 2", "Nov 3", "Nov 4", "Nov 5", "Nov 6", "Nov 7", "Nov 8", "Nov 9", "Nov 10", "Nov 11", "Nov 12", "Nov 13", "Nov 14", "Nov 15", "Nov 16", "Nov 17", "Nov 18", "Nov 19", "Nov 20", "Nov 21", "Nov 22", "Nov 23", "Nov 24", "Nov 25", "Nov 26", "Nov 27", "Nov 28", "Nov 29", "Nov 30", "Dec 1", "Dec 2", "Dec 3", "Dec 4", "Dec 5", "Dec 6", "Dec 7", "Dec 8", "Dec 9", "Dec 10", "Dec 11", "Dec 12", "Dec 13", "Dec 14", "Dec 15", "Dec 16", "Dec 17", "Dec 18", "Dec 19", "Dec 20", "Dec 21", "Dec 22", "Dec 23", "Dec 24", "Dec 25", "Dec 26", "Dec 27", "Dec 28", "Dec 29", "Dec 30", "Dec 31"
                    ]
                },
                food: {
                    name: "What to Eat Today",
                    items: [
                        "Pizza", "Burger", "Sushi", "Tacos", "Pasta", "Salad",
                        "Steak", "Chicken", "Fish", "Sandwich", "Soup", "Curry",
                        "Ramen", "BBQ", "Stir Fry", "Burrito", "Dumplings", "Noodles",
                        "Rice Bowl", "Seafood", "Vegetables", "Fruit", "Dessert", "Ice Cream"
                    ]
                },
                movie: {
                    name: "What Movie to Watch",
                    items: [
                        "Action", "Comedy", "Drama", "Horror", "Sci-Fi", "Romance",
                        "Thriller", "Adventure", "Fantasy", "Animation", "Documentary", "Musical",
                        "Mystery", "Crime", "Western", "War", "Biography", "Family",
                        "Sports", "Superhero", "Historical", "Noir", "Satire", "Silent"
                    ]
                },
                color: {
                    name: "Random Color Picker",
                    items: [
                        "Red", "Orange", "Yellow", "Green", "Blue", "Purple",
                        "Pink", "Brown", "Black", "White", "Gray", "Cyan",
                        "Magenta", "Lavender", "Teal", "Maroon", "Navy", "Olive",
                        "Silver", "Gold", "Beige", "Turquoise", "Indigo", "Violet"
                    ]
                },
                exercise: {
                    name: "Daily Exercise",
                    items: [
                        "Running", "Cycling", "Swimming", "Weightlifting", "Yoga", "Pilates",
                        "Dancing", "Hiking", "Jumping Rope", "Push-ups", "Sit-ups", "Squats",
                        "Lunges", "Plank", "Burpees", "Jumping Jacks", "Stretching", "Walking",
                        "Rowing", "Elliptical", "Kickboxing", "Martial Arts", "Zumba", "Tai Chi"
                    ]
                },
                book: {
                    name: "Next Book to Read",
                    items: [
                        "Fiction", "Non-Fiction", "Mystery", "Sci-Fi", "Fantasy", "Romance",
                        "Thriller", "Horror", "Historical", "Biography", "Autobiography", "Memoir",
                        "Self-Help", "Science", "Philosophy", "Poetry", "Drama", "Comedy",
                        "Adventure", "Crime", "Graphic Novel", "Young Adult", "Children's", "Classic"
                    ]
                },
                travel: {
                    name: "Next Vacation Spot",
                    items: [
                        "Beach", "Mountains", "City", "Countryside", "Desert", "Forest",
                        "Island", "Lake", "River", "Ocean", "Historical Site", "Theme Park",
                        "Ski Resort", "Camping", "Cruise", "Road Trip", "Backpacking", "Luxury Resort",
                        "Safari", "Wine Country", "Cultural Tour", "Food Tour", "Adventure", "Relaxation"
                    ]
                },
                game: {
                    name: "Game to Play",
                    items: [
                        "Board Game", "Card Game", "Video Game", "Puzzle", "Word Game", "Trivia",
                        "Sports Game", "Strategy Game", "Action Game", "Adventure Game", "RPG", "Simulation",
                        "Party Game", "Dice Game", "Arcade Game", "Mobile Game", "Online Game", "Chess",
                        "Checkers", "Backgammon", "Dominoes", "Bingo", "Charades", "Pictionary"
                    ]
                },
                chore: {
                    name: "Chore Roulette",
                    items: [
                        "Dishes", "Laundry", "Vacuuming", "Mopping", "Dusting", "Bathroom Cleaning",
                        "Kitchen Cleaning", "Window Cleaning", "Garden Work", "Take Out Trash", "Recycling", "Organizing",
                        "Decluttering", "Cooking", "Grocery Shopping", "Pet Care", "Car Wash", "Yard Work",
                        "Bed Making", "Ironing", "Sweeping", "Wipe Surfaces", "Clean Fridge", "Clean Oven"
                    ]
                },
                song: {
                    name: "Song of the Day",
                    items: [
                        "Pop", "Rock", "Hip Hop", "R&B", "Jazz", "Blues",
                        "Country", "Electronic", "Classical", "Reggae", "Metal", "Folk",
                        "Indie", "Alternative", "Punk", "Soul", "Funk", "Disco",
                        "Gospel", "Latin", "World", "K-Pop", "J-Pop", "Opera"
                    ]
                },
                drink: {
                    name: "Drink Mixer",
                    items: [
                        "Water", "Coffee", "Tea", "Soda", "Juice", "Smoothie",
                        "Milkshake", "Lemonade", "Iced Tea", "Hot Chocolate", "Energy Drink", "Sports Drink",
                        "Wine", "Beer", "Cocktail", "Whiskey", "Vodka", "Rum",
                        "Tequila", "Gin", "Brandy", "Champagne", "Mocktail", "Infused Water"
                    ]
                },
                superhero: {
                    name: "Superhero Powers",
                    items: [
                        "Flight", "Super Strength", "Invisibility", "Teleportation", "Telepathy", "Telekinesis",
                        "Super Speed", "Healing", "Shape-shifting", "Element Control", "Time Manipulation", "Mind Control",
                        "Force Fields", "Energy Blasts", "X-Ray Vision", "Wall Crawling", "Water Breathing", "Size Changing",
                        "Intangibility", "Duplication", "Weather Control", "Animal Communication", "Super Intelligence", "Immortality"
                    ]
                },
                fortune: {
                    name: "Fortune Teller",
                    items: [
                        "Great Success", "Unexpected Money", "New Friendship", "Romance", "Travel Opportunity", "Career Advancement",
                        "Good Health", "Happiness", "Wisdom", "Creativity", "Adventure", "Inner Peace",
                        "Recognition", "Good Luck", "Positive Change", "Spiritual Growth", "Family Harmony", "Personal Achievement",
                        "New Beginning", "Unexpected Joy", "Inspiration", "Courage", "Patience", "Gratitude"
                    ]
                }
            };
            
            // Initialize the wheel
            function init() {
                // Check if audio is supported and can be enabled
                checkAudioSupport();
                
                // Generate the initial wheel
                generateWheel();
                
                // Set up event listeners
                setupEventListeners();
                
                // Load saved wheels
                loadSavedWheels();
                
                // Load saved theme
                loadSavedTheme();
            }
            
            // Check if audio is supported
            function checkAudioSupport() {
                audioEnabled = !!(window.AudioContext || window.webkitAudioContext);
                
                if (!audioEnabled) {
                    audioToggle.style.display = 'none';
                } else {
                    audioToggle.addEventListener('click', toggleAudio);
                }
            }
            
            // Toggle audio on/off
            function toggleAudio() {
                audioMuted = !audioMuted;
                
                if (audioMuted) {
                    audioToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
                    audioToggle.classList.add('muted');
                } else {
                    audioToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                    audioToggle.classList.remove('muted');
                }
            }
            
            // Set up event listeners
            function setupEventListeners() {
                generateBtn.addEventListener('click', generateWheel);
                spinBtn.addEventListener('click', spinWheel);
                wheelContainer.addEventListener('click', spinWheel);
                
                spinSpeedSelect.addEventListener('change', function() {
                    if (this.value === 'custom') {
                        customDurationGroup.style.display = 'flex';
                    } else {
                        customDurationGroup.style.display = 'none';
                    }
                });
                
                saveBtn.addEventListener('click', saveWheel);
                loadBtn.addEventListener('click', loadWheel);
                copyBtn.addEventListener('click', copyWheelData);
                fileInput.addEventListener('change', handleFileUpload);
                
                if (menuButton) {
                    menuButton.addEventListener('click', toggleMenu);
                } else {
                    console.error('menuButton not found');
                }
                
                // Menu navigation
                presetWheelsBtn.addEventListener('click', function() {
                    presetWheelsSection.style.display = 'block';
                    menuPanel.classList.remove('show');
                });
                
                customWheelBtn.addEventListener('click', function() {
                    presetWheelsSection.style.display = 'none';
                    menuPanel.classList.remove('show');
                });
                
                savedWheelsBtn.addEventListener('click', function() {
                    loadSavedWheels();
                    menuPanel.classList.remove('show');
                });
                
                // Preset wheel buttons (menu)
                dollarsBtn.addEventListener('click', function() { loadPresetWheel('dollars'); });
                countriesBtn.addEventListener('click', function() { loadPresetWheel('countries'); });
                birthdayBtn.addEventListener('click', function() { loadPresetWheel('birthday'); });
                foodBtn.addEventListener('click', function() { loadPresetWheel('food'); });
                movieBtn.addEventListener('click', function() { loadPresetWheel('movie'); });
                colorBtn.addEventListener('click', function() { loadPresetWheel('color'); });
                exerciseBtn.addEventListener('click', function() { loadPresetWheel('exercise'); });
                bookBtn.addEventListener('click', function() { loadPresetWheel('book'); });
                travelBtn.addEventListener('click', function() { loadPresetWheel('travel'); });
                gameBtn.addEventListener('click', function() { loadPresetWheel('game'); });
                choreBtn.addEventListener('click', function() { loadPresetWheel('chore'); });
                songBtn.addEventListener('click', function() { loadPresetWheel('song'); });
                drinkBtn.addEventListener('click', function() { loadPresetWheel('drink'); });
                superheroBtn.addEventListener('click', function() { loadPresetWheel('superhero'); });
                fortuneBtn.addEventListener('click', function() { loadPresetWheel('fortune'); });
                
                // Preset wheel buttons (main section)
                presetDollarsBtn.addEventListener('click', function() { loadPresetWheel('dollars'); });
                presetCountriesBtn.addEventListener('click', function() { loadPresetWheel('countries'); });
                presetBirthdayBtn.addEventListener('click', function() { loadPresetWheel('birthday'); });
                presetFoodBtn.addEventListener('click', function() { loadPresetWheel('food'); });
                presetMovieBtn.addEventListener('click', function() { loadPresetWheel('movie'); });
                presetColorBtn.addEventListener('click', function() { loadPresetWheel('color'); });
                presetExerciseBtn.addEventListener('click', function() { loadPresetWheel('exercise'); });
                presetBookBtn.addEventListener('click', function() { loadPresetWheel('book'); });
                presetTravelBtn.addEventListener('click', function() { loadPresetWheel('travel'); });
                presetGameBtn.addEventListener('click', function() { loadPresetWheel('game'); });
                presetChoreBtn.addEventListener('click', function() { loadPresetWheel('chore'); });
                presetSongBtn.addEventListener('click', function() { loadPresetWheel('song'); });
                presetDrinkBtn.addEventListener('click', function() { loadPresetWheel('drink'); });
                presetSuperheroBtn.addEventListener('click', function() { loadPresetWheel('superhero'); });
                presetFortuneBtn.addEventListener('click', function() { loadPresetWheel('fortune'); });
                
            // Wheel info panel event listeners
            if (wheelInfoBtn) {
                wheelInfoBtn.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent wheel spin
                    showWheelInfo();
                });
            } else {
                console.error('wheelInfoBtn not found');
            }
            
            if (closeInfoBtn) {
                closeInfoBtn.addEventListener('click', hideWheelInfo);
            }
            if (wheelInfoOverlay) {
                wheelInfoOverlay.addEventListener('click', hideWheelInfo);
            }
            if (resetStatsBtn) {
                resetStatsBtn.addEventListener('click', resetWheelStats);
            }
            
            // Theme event listeners
            if (normalTheme) normalTheme.addEventListener('click', () => setTheme('normal'));
            if (darkTheme) darkTheme.addEventListener('click', () => setTheme('dark'));
            if (rainbowTheme) rainbowTheme.addEventListener('click', () => setTheme('rainbow'));
            
            // Theme panel toggle functionality
            if (themeCloseBtn) {
                themeCloseBtn.addEventListener('click', hideThemePanel);
            }
            if (themeShowBtn) {
                themeShowBtn.addEventListener('click', showThemePanel);
            }
            
            function hideThemePanel() {
                if (themeSelector) {
                    themeSelector.classList.add('hidden');
                }
                if (themeShowBtn) {
                    themeShowBtn.classList.add('visible');
                }
            }
            
            function showThemePanel() {
                if (themeSelector) {
                    themeSelector.classList.remove('hidden');
                }
                if (themeShowBtn) {
                    themeShowBtn.classList.remove('visible');
                }
            }

            // NEW FEATURE EVENT LISTENERS

            // Wheel Battles
            const startBattleBtn = document.getElementById('startBattleBtn');
            if (startBattleBtn) {
                startBattleBtn.addEventListener('click', startWheelBattle);
            }

            // Casino
            const casinoSpinBtn = document.getElementById('casinoSpinBtn');
            const chips = document.querySelectorAll('.chip');
            if (casinoSpinBtn) {
                casinoSpinBtn.addEventListener('click', casinoSpin);
            }
            chips.forEach(chip => {
                chip.addEventListener('click', function() {
                    placeBet(parseInt(this.dataset.value));
                });
            });

            // Weather
            const updateWeatherBtn = document.getElementById('updateWeatherBtn');
            if (updateWeatherBtn) {
                updateWeatherBtn.addEventListener('click', updateWeather);
            }

            // Voice Control
            const micButton = document.getElementById('micButton');
            if (micButton) {
                micButton.addEventListener('click', toggleVoiceControl);
            }

            // Background Selector
            const bgOptions = document.querySelectorAll('.bg-option');
            bgOptions.forEach(option => {
                option.addEventListener('click', function() {
                    changeBackground(this.dataset.bg);
                });
            });

            // Color Picker
            const colorPickers = document.querySelectorAll('.color-picker');
            colorPickers.forEach(picker => {
                picker.addEventListener('click', function() {
                    selectColor(this.dataset.color);
                });
            });

            // Slot Machine
            const slotSpinBtn = document.getElementById('slotSpinBtn');
            if (slotSpinBtn) {
                slotSpinBtn.addEventListener('click', spinSlots);
            }

            // Social Sharing
            const shareTwitter = document.getElementById('shareTwitter');
            const shareFacebook = document.getElementById('shareFacebook');
            const shareInstagram = document.getElementById('shareInstagram');
            const shareTiktok = document.getElementById('shareTiktok');
            
            if (shareTwitter) shareTwitter.addEventListener('click', () => shareToSocial('twitter'));
            if (shareFacebook) shareFacebook.addEventListener('click', () => shareToSocial('facebook'));
            if (shareInstagram) shareInstagram.addEventListener('click', () => shareToSocial('instagram'));
            if (shareTiktok) shareTiktok.addEventListener('click', () => shareToSocial('tiktok'));

            // Mini Games
            const guessNumberGame = document.getElementById('guessNumberGame');
            const memoryGame = document.getElementById('memoryGame');
            const reactionGame = document.getElementById('reactionGame');
            const mathQuizGame = document.getElementById('mathQuizGame');
            const colorMatchGame = document.getElementById('colorMatchGame');
            
            if (guessNumberGame) guessNumberGame.addEventListener('click', () => playMiniGame('guess'));
            if (memoryGame) memoryGame.addEventListener('click', () => playMiniGame('memory'));
            if (reactionGame) reactionGame.addEventListener('click', () => playMiniGame('reaction'));
            if (mathQuizGame) mathQuizGame.addEventListener('click', () => playMiniGame('math'));
            if (colorMatchGame) colorMatchGame.addEventListener('click', () => playMiniGame('color'));

            // Reality Check
            const continueBtn = document.getElementById('continueBtn');
            const takeBreakBtn = document.getElementById('takeBreakBtn');
            if (continueBtn) continueBtn.addEventListener('click', () => hidePanel('realityCheck'));
            if (takeBreakBtn) takeBreakBtn.addEventListener('click', takeBreak);

            // Secret Achievement
            const secretBtn = document.getElementById('secretBtn');
            if (secretBtn) secretBtn.addEventListener('click', activateSecretMode);

            // Initialize new features
            updateWeather();
            startSessionTimer();
            initializeGameState();
            if (neonTheme) neonTheme.addEventListener('click', () => setTheme('neon'));
            if (theme3d) theme3d.addEventListener('click', () => setTheme('3d'));
            if (discoTheme) discoTheme.addEventListener('click', () => setTheme('disco'));
            
            // Load saved wheel statistics
            loadWheelStats();

            // Winning history expand/collapse
            const toggleWinHistoryBtn = document.getElementById('toggleWinHistoryBtn');
            if (toggleWinHistoryBtn) {
                toggleWinHistoryBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    winHistoryExpanded = !winHistoryExpanded;
                    loadWheelStats();
                    updateWheelStatsDisplay();
                });
            }
        };
            
            // Toggle menu panel
            function toggleMenu() {
                menuPanel.classList.toggle('show');
            }
            
            // Show wheel info panel
            function showWheelInfo() {
                if (!wheelInfoPanel || !wheelInfoOverlay) {
                    console.error('Required elements not found for wheel info panel');
                    return;
                }
                loadWheelStats(); // Load current wheel's specific stats
                updateWheelStatsDisplay();
                wheelInfoPanel.classList.add('show');
                wheelInfoOverlay.classList.add('show');
            }
            
            // Hide wheel info panel
            function hideWheelInfo() {
                wheelInfoPanel.classList.remove('show');
                wheelInfoOverlay.classList.remove('show');
            }
            
            // Update wheel stats display
            function updateWheelStatsDisplay() {
                const stats = getWheelStats();
                document.getElementById('totalSpins').textContent = stats.totalSpins;
                document.getElementById('totalSlices').textContent = slices.length;
                document.getElementById('wheelInfoName').textContent = wheelNameInput.value || 'Custom Wheel';
                
                // Update win history
                const winList = document.getElementById('winList');
                const toggleBtn = document.getElementById('toggleWinHistoryBtn');
                const historyCount = document.getElementById('historyCount');
                const wheelInfoPanelEl = document.getElementById('wheelInfoPanel');
                
                if (stats.winHistory.length === 0) {
                    winHistoryExpanded = false;
                    winList.innerHTML = '<p style="text-align: center; color: #999;">No spins yet!</p>';
                    winList.classList.remove('expanded');
                    winList.classList.add('collapsed');
                    winList.classList.remove('fit-hide-date');
                    clearWinHistoryFit(winList);
                    if (historyCount) historyCount.textContent = '';
                    if (toggleBtn) {
                        toggleBtn.disabled = true;
                        toggleBtn.title = 'No history yet';
                        toggleBtn.innerHTML = '<i class="fas fa-chevron-down" aria-hidden="true"></i>';
                    }
                } else {
                    const total = stats.winHistory.length;
                    const indicesToRender = [];
                    if (winHistoryExpanded) {
                        for (let i = total - 1; i >= 0; i--) indicesToRender.push(i);
                    } else {
                        const start = Math.max(0, total - 10);
                        for (let i = total - 1; i >= start; i--) indicesToRender.push(i);
                    }

                    winList.classList.toggle('expanded', winHistoryExpanded);
                    winList.classList.toggle('collapsed', !winHistoryExpanded);

                    // Fullscreen panel + compact mode when expanded.
                    // Note: "one screen without scrolling" is physically impossible for arbitrarily many items
                    // unless we reduce per-item height; compact mode helps squeeze more items into the viewport.
                    if (wheelInfoPanelEl) {
                        wheelInfoPanelEl.classList.toggle('history-expanded', winHistoryExpanded);
                    }

                    // Compact mode remains as a fallback, but fitting is primarily handled dynamically
                    const shouldCompact = winHistoryExpanded && total > 120;
                    winList.classList.toggle('compact', shouldCompact);
                    if (!winHistoryExpanded) {
                        winList.classList.remove('fit-hide-date');
                        clearWinHistoryFit(winList);
                    }

                    // Update history count display
                    if (historyCount) {
                        if (winHistoryExpanded) {
                            historyCount.textContent = `(${total} ${total === 1 ? 'result' : 'results'})`;
                        } else {
                            const shown = Math.min(10, total);
                            historyCount.textContent = `(${shown} of ${total})`;
                        }
                    }

                    if (toggleBtn) {
                        toggleBtn.disabled = false;
                        const hiddenCount = Math.max(0, total - 10);
                        if (winHistoryExpanded) {
                            toggleBtn.title = `Collapse history (showing all ${total} results)`;
                            toggleBtn.innerHTML = '<i class="fas fa-chevron-up" aria-hidden="true"></i>';
                        } else {
                            if (hiddenCount > 0) {
                                toggleBtn.title = `Show all ${total} results (${hiddenCount} more)`;
                                toggleBtn.innerHTML = `<i class="fas fa-chevron-down" aria-hidden="true"></i> <span style="font-size: 11px; margin-left: 4px;">+${hiddenCount}</span>`;
                            } else {
                                toggleBtn.title = 'Show all history';
                                toggleBtn.innerHTML = '<i class="fas fa-chevron-down" aria-hidden="true"></i>';
                            }
                        }
                    }

                    // Render
                    if (winHistoryExpanded && indicesToRender.length > 300) {
                        winList.innerHTML = '<p style="text-align: center; color: #999;"><i class="fas fa-spinner fa-spin"></i> Preparing full history</p>';
                        setTimeout(() => renderWinHistory(winList, indicesToRender, stats), 10);
                    } else {
                        renderWinHistory(winList, indicesToRender, stats);
                    }
                }
            }
            
            // Render win history items efficiently
            function renderWinHistory(winList, indicesToRender, stats) {
                // Use DocumentFragment for better performance with large lists
                const fragment = document.createDocumentFragment();
                
                indicesToRender.forEach((actualIndex) => {
                    const win = stats.winHistory[actualIndex];
                    const winItem = document.createElement('div');
                    winItem.className = 'win-item';
                    
                    const winText = document.createElement('span');
                    winText.className = 'win-text';
                    winText.style.flex = '1';
                    winText.textContent = win.result;
                    
                    const winDate = document.createElement('span');
                    winDate.className = 'win-date';
                    winDate.textContent = new Date(win.timestamp).toLocaleDateString();
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-spin-btn';
                    deleteBtn.setAttribute('data-index', actualIndex);
                    deleteBtn.title = 'Delete this result';
                    deleteBtn.textContent = '';
                    deleteBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const index = parseInt(this.getAttribute('data-index'));
                        deleteSingleSpin(index);
                    });
                    
                    winItem.appendChild(winText);
                    winItem.appendChild(winDate);
                    winItem.appendChild(deleteBtn);
                    fragment.appendChild(winItem);
                });
                
                winList.innerHTML = '';
                winList.appendChild(fragment);

                // If the user expanded the list, shrink-to-fit based on result count
                scheduleWinHistoryFit();
            }

            let winHistoryFitRaf = null;
            function scheduleWinHistoryFit() {
                if (!winHistoryExpanded) return;
                const winList = document.getElementById('winList');
                const panel = document.getElementById('wheelInfoPanel');
                if (!winList || !panel) return;
                if (!panel.classList.contains('history-expanded')) return;
                if (!winList.classList.contains('expanded')) return;

                if (winHistoryFitRaf) cancelAnimationFrame(winHistoryFitRaf);
                winHistoryFitRaf = requestAnimationFrame(() => {
                    winHistoryFitRaf = null;
                    applyWinHistoryFit(winList);
                    // Second pass helps after layout settles (columns/scrollbars)
                    setTimeout(() => {
                        if (winHistoryExpanded) applyWinHistoryFit(winList);
                    }, 0);
                });
            }

            function clearWinHistoryFit(winList) {
                if (!winList) return;
                winList.style.removeProperty('--win-item-gap');
                winList.style.removeProperty('--win-item-padding-y');
                winList.style.removeProperty('--win-item-padding-x');
                winList.style.removeProperty('--win-item-font-size');
                winList.style.removeProperty('--win-date-font-size');
                winList.style.removeProperty('--delete-btn-size');
                winList.style.removeProperty('--delete-btn-font-size');
            }

            function clampNumber(value, min, max) {
                return Math.max(min, Math.min(max, value));
            }

            function getExpandedColumnCount(winList) {
                const cs = window.getComputedStyle(winList);
                const raw = parseInt(cs.columnCount, 10);
                if (!Number.isFinite(raw) || raw <= 0) return 1;
                return raw;
            }

            function applyWinHistoryFit(winList) {
                const items = winList.querySelectorAll('.win-item');
                const total = items.length;
                if (!total) return;

                const cs = window.getComputedStyle(winList);
                const paddingTop = parseFloat(cs.paddingTop) || 0;
                const paddingBottom = parseFloat(cs.paddingBottom) || 0;
                const availableHeight = Math.max(0, winList.clientHeight - paddingTop - paddingBottom);

                const colCount = getExpandedColumnCount(winList);
                const itemsPerCol = Math.max(1, Math.ceil(total / colCount));
                const rowHeight = availableHeight / itemsPerCol;

                // Gap between rows (smaller when many items)
                const gap = clampNumber(Math.floor(rowHeight * 0.18), 2, 8);
                // Font-size scales with row height but remains readable
                const fontSize = clampNumber(Math.floor(rowHeight * 0.42), 10, 16);
                const dateFontSize = clampNumber(Math.floor(fontSize * 0.85), 9, 13);
                // Padding tries to keep rows comfortable without causing overflow
                const paddingY = clampNumber(Math.floor((rowHeight - gap - (fontSize * 1.2)) / 2), 1, 10);
                const paddingX = clampNumber(Math.floor(fontSize * 0.9), 6, 14);

                const deleteBtnSize = clampNumber(Math.floor(fontSize * 1.6), 16, 24);
                const deleteBtnFont = clampNumber(Math.floor(deleteBtnSize * 0.65), 12, 16);

                winList.style.setProperty('--win-item-gap', `${gap}px`);
                winList.style.setProperty('--win-item-padding-y', `${paddingY}px`);
                winList.style.setProperty('--win-item-padding-x', `${paddingX}px`);
                winList.style.setProperty('--win-item-font-size', `${fontSize}px`);
                winList.style.setProperty('--win-date-font-size', `${dateFontSize}px`);
                winList.style.setProperty('--delete-btn-size', `${deleteBtnSize}px`);
                winList.style.setProperty('--delete-btn-font-size', `${deleteBtnFont}px`);

                // Hide the date only when we need the space
                const hideDate = rowHeight < 22 || fontSize <= 11;
                winList.classList.toggle('fit-hide-date', hideDate);
            }

            // Keep expanded history fitted when viewport changes
            window.addEventListener('resize', () => {
                if (winHistoryExpanded) scheduleWinHistoryFit();
            });
            
            // Load wheel statistics from localStorage
            function loadWheelStats() {
                const wheelName = wheelNameInput.value || 'Custom Wheel';
                const allWheelStats = JSON.parse(localStorage.getItem('allWheelStats') || '{}');
                wheelStats = allWheelStats[wheelName] || {
                    totalSpins: 0, 
                    winHistory: [], 
                    wheelName: wheelName
                };
            }
            
            // Save wheel statistics to localStorage
            function saveWheelStats() {
                const wheelName = wheelNameInput.value || 'Custom Wheel';
                const allWheelStats = JSON.parse(localStorage.getItem('allWheelStats') || '{}');
                wheelStats.wheelName = wheelName;
                allWheelStats[wheelName] = wheelStats;
                localStorage.setItem('allWheelStats', JSON.stringify(allWheelStats));
            }
            
            // Get wheel statistics
            function getWheelStats() {
                return wheelStats;
            }
            
            // Add win to statistics
            function addWinToStats(result) {
                // Load current wheel's stats first
                loadWheelStats();
                wheelStats.totalSpins++;
                wheelStats.winHistory.push({
                    result: result,
                    timestamp: new Date().toISOString(),
                    wheelName: wheelNameInput.value || 'Custom Wheel'
                });
                saveWheelStats();
            }
            
            // Delete a single spin from history
            function deleteSingleSpin(index) {
                const wheelName = wheelNameInput.value || 'Custom Wheel';
                const spinResult = wheelStats.winHistory[index].result;
                const spinDate = new Date(wheelStats.winHistory[index].timestamp).toLocaleString();
                
                if (confirm(`Are you sure you want to delete this spin result?\n\nResult: ${spinResult}\nDate: ${spinDate}\n\nThis action cannot be undone.`)) {
                    // Load current stats
                    loadWheelStats();
                    
                    // Remove the specific spin
                    wheelStats.winHistory.splice(index, 1);
                    
                    // Update total spins count
                    wheelStats.totalSpins = Math.max(0, wheelStats.totalSpins - 1);
                    
                    // Save updated stats
                    saveWheelStats();
                    
                    // Refresh the display
                    updateWheelStatsDisplay();
                }
            }
            
            // Reset wheel statistics
            function resetWheelStats() {
                const wheelName = wheelNameInput.value || 'Custom Wheel';
                if (confirm(`Are you sure you want to reset statistics for "${wheelName}"? This action cannot be undone.`)) {
                    wheelStats = {
                        totalSpins: 0,
                        winHistory: [],
                        wheelName: wheelName
                    };
                    saveWheelStats();
                    updateWheelStatsDisplay();
                    alert(`Statistics for "${wheelName}" have been reset!`);
                }
            }
            
            // Theme Functions
            function setTheme(theme) {
                // Remove all theme classes
                document.body.classList.remove('dark-mode', 'rainbow-mode', 'neon-mode', 'mode-3d', 'disco-mode');
                document.documentElement.classList.remove('dark-mode', 'rainbow-mode', 'neon-mode', 'mode-3d', 'disco-mode');
                
                // Add new theme class
                switch(theme) {
                    case 'dark':
                        document.body.classList.add('dark-mode');
                        createStars();
                        break;
                    case 'rainbow':
                        document.body.classList.add('rainbow-mode');
                        break;
                    case 'neon':
                        document.body.classList.add('neon-mode');
                        createNeonEffects();
                        break;
                    case '3d':
                        document.body.classList.add('mode-3d');
                        break;
                    case 'disco':
                        document.body.classList.add('disco-mode');
                        createDiscoEffects();
                        break;
                    default:
                        // Normal theme
                        break;
                }
                
                // Save theme preference
                localStorage.setItem('wheelTheme', theme);
                
                // Add screen shake effect
                document.body.classList.add('screen-shake');
                setTimeout(() => document.body.classList.remove('screen-shake'), 500);
            }
            
            // Create stars for dark mode
            function createStars() {
                const existingStars = document.querySelector('.stars');
                if (existingStars) existingStars.remove();
                
                const stars = document.createElement('div');
                stars.className = 'stars';
                stars.style.position = 'fixed';
                stars.style.top = '0';
                stars.style.left = '0';
                stars.style.width = '100%';
                stars.style.height = '100%';
                stars.style.pointerEvents = 'none';
                stars.style.zIndex = '0';
                
                for (let i = 0; i < 100; i++) {
                    const star = document.createElement('div');
                    star.style.position = 'absolute';
                    star.style.width = '2px';
                    star.style.height = '2px';
                    star.style.background = 'white';
                    star.style.borderRadius = '50%';
                    star.style.left = Math.random() * 100 + '%';
                    star.style.top = Math.random() * 100 + '%';
                    star.style.animation = `twinkle ${Math.random() * 3 + 1}s infinite`;
                    stars.appendChild(star);
                }
                
                document.body.appendChild(stars);
                
                // Add twinkle animation
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes twinkle {
                        0%, 100% { opacity: 0.3; }
                        50% { opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Create neon effects
            function createNeonEffects() {
                // Add pulsing neon border to wheel
                const wheel = document.getElementById('wheel');
                if (wheel) {
                    wheel.style.border = '3px solid #00ffff';
                    wheel.style.boxShadow = '0 0 30px #00ffff, inset 0 0 30px #ff00ff';
                }
            }
            
            // Create disco effects
            function createDiscoEffects() {
                const audio = new Audio();
                audio.volume = 0.1;
                // Note: Would need actual disco music file
                // audio.src = 'disco-music.mp3';
                // audio.play();
            }
            
            // Enhanced winner celebration
            function megaCelebration() {
                // Screen shake
                document.body.classList.add('screen-shake');
                setTimeout(() => document.body.classList.remove('screen-shake'), 1000);
                
                // Rainbow winner text
                resultDisplay.classList.add('mega-winner');
                setTimeout(() => resultDisplay.classList.remove('mega-winner'), 5000);
                
                // Create extra confetti burst
                for (let i = 0; i < 100; i++) {
                    setTimeout(() => createConfetti(), i * 50);
                }
                
                // Create fireworks
                for (let i = 0; i < 20; i++) {
                    setTimeout(() => {
                        const x = Math.random() * window.innerWidth;
                        const y = Math.random() * window.innerHeight;
                        createFireworks(x, y);
                    }, i * 200);
                }
            }
            
            // Load saved theme
            function loadSavedTheme() {
                const savedTheme = localStorage.getItem('wheelTheme') || 'normal';
                setTheme(savedTheme);
            }
            
            // Generate the wheel
            function generateWheel() {
                const sliceCount = parseInt(sliceCountInput.value);
                
                // Clear the wheel
                wheel.innerHTML = '';
                sliceConfig.innerHTML = '';
                slices = [];
                
                // Create SVG wheel
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', '100%');
                svg.setAttribute('height', '100%');
                svg.setAttribute('viewBox', '0 0 400 400');
                svg.style.position = 'absolute';
                svg.style.top = '0';
                svg.style.left = '0';
                
                const radius = 180;
                const centerX = 200;
                const centerY = 200;
                
                // Calculate angle for each slice
                const anglePerSlice = 360 / sliceCount;
                
                // Generate slices
                let previousColor = null;
                for (let i = 0; i < sliceCount; i++) {
                    const color = getDistinctColor(i, previousColor);
                    previousColor = color;
                    
                    // Calculate slice path
                    const startAngle = (i * anglePerSlice - 90) * Math.PI / 180; // Start from top
                    const endAngle = ((i + 1) * anglePerSlice - 90) * Math.PI / 180;
                    
                    const x1 = centerX + radius * Math.cos(startAngle);
                    const y1 = centerY + radius * Math.sin(startAngle);
                    const x2 = centerX + radius * Math.cos(endAngle);
                    const y2 = centerY + radius * Math.sin(endAngle);
                    
                    const largeArcFlag = anglePerSlice > 180 ? 1 : 0;
                    
                    // Create SVG path for pie slice
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const pathData = `M ${centerX} ${centerY} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2} Z`;
                    path.setAttribute('d', pathData);
                    path.setAttribute('fill', color);
                    path.setAttribute('stroke', '#ffffff');
                    path.setAttribute('stroke-width', '2');
                    
                    svg.appendChild(path);
                    
                    // Create text element
                    // Only add text if 20 or fewer slices
                    let text = null;
                    if (sliceCount <= 20) {
                        const textAngle = (i * anglePerSlice + anglePerSlice / 2 - 90) * Math.PI / 180;
                        const textRadius = radius * 0.7;
                        const textX = centerX + textRadius * Math.cos(textAngle);
                        const textY = centerY + textRadius * Math.sin(textAngle);
                        
                        text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                        text.setAttribute('x', textX);
                        text.setAttribute('y', textY);
                        text.setAttribute('text-anchor', 'middle');
                        text.setAttribute('dominant-baseline', 'middle');
                        text.setAttribute('fill', 'white');
                        text.setAttribute('font-weight', 'bold');
                        text.setAttribute('font-size', '16');
                        text.setAttribute('font-family', 'Arial, sans-serif');
                        text.style.filter = 'drop-shadow(1px 1px 2px rgba(0,0,0,0.8))';
                        text.textContent = `IDEA ${i + 1}`;
                        
                        svg.appendChild(text);
                    }
                    
                    // Store slice data
                    slices.push({
                        text: `IDEA ${i + 1}`,
                        color: color,
                        path: path,
                        textElement: text
                    });
                    
                    // Create slice configuration input
                    const sliceItem = document.createElement('div');
                    sliceItem.className = 'slice-item';
                    
                    const colorInput = document.createElement('input');
                    colorInput.type = 'color';
                    colorInput.value = color;
                    colorInput.addEventListener('change', function() {
                        slices[i].color = this.value;
                        path.setAttribute('fill', this.value);
                    });
                    
                    const textInput = document.createElement('input');
                    textInput.type = 'text';
                    textInput.value = `IDEA ${i + 1}`;
                    textInput.addEventListener('input', function() {
                        slices[i].text = this.value;
                        if (text) { // Only update text if it exists (20 or fewer slices)
                            text.textContent = this.value;
                        }

                        // Quick visual feedback to make editing feel snappy.
                        sliceItem.classList.remove('edited');
                        // Force reflow so the animation can restart on rapid edits.
                        void sliceItem.offsetWidth;
                        sliceItem.classList.add('edited');
                    });
                    
                    sliceItem.appendChild(colorInput);
                    sliceItem.appendChild(textInput);
                    sliceConfig.appendChild(sliceItem);
                }
                
                wheel.appendChild(svg);
                
                // Add center spin button
                const center = document.createElement('div');
                center.className = 'wheel-center';
                center.innerHTML = '<span>Spin</span>';
                center.addEventListener('click', spinWheel);
                wheel.appendChild(center);
                
                // Update wheel data
                updateWheelData();
                
                // Load stats for this specific wheel
                loadWheelStats();
                
                // Reset result display
                if (resultDisplay) {
                    resultDisplay.classList.remove('show', 'winner');
                    const resultText = resultDisplay.querySelector('.result-text');
                    if (resultText) resultText.textContent = 'Spin the wheel to see the result!';
                }
                if (resultCelebration) {
                    resultCelebration.classList.remove('show');
                }
            }
            
            // Update wheel data in textarea
            function updateWheelData() {
                const wheelData = {
                    name: wheelNameInput.value,
                    slices: slices
                };
                
                wheelDataTextarea.value = JSON.stringify(wheelData, null, 2);
            }
            
            // Spin the wheel
            function spinWheel() {
                if (isSpinning) return;
                
                isSpinning = true;
                resultDisplay.classList.remove('show');
                resultDisplay.classList.remove('winner');
                
                // Add spinning glow effect
                wheelContainer.classList.add('spinning');
                
                // Create fireworks at wheel center during spin
                const wheelRect = wheelContainer.getBoundingClientRect();
                const centerX = wheelRect.left + wheelRect.width / 2;
                const centerY = wheelRect.top + wheelRect.height / 2;
                
                const fireworkInterval = setInterval(() => {
                    createFireworks(centerX + (Math.random() - 0.5) * 100, centerY + (Math.random() - 0.5) * 100);
                }, 200);
                
                // Determine spin duration
                let duration;
                switch (spinSpeedSelect.value) {
                    case 'slow':
                        duration = 15000;
                        break;
                    case 'fast':
                        duration = 8000;
                        break;
                    case 'custom':
                        duration = parseInt(customDurationInput.value);
                        break;
                    default: // medium
                        duration = 12000;
                }
                
                // Calculate random rotation (at least 8 full rotations)
                const rotations = 8 + Math.floor(Math.random() * 6);
                const targetRotation = currentRotation + (rotations * 360) + (Math.random() * 360);
                currentRotation = targetRotation;
                
                // Play spin sound if audio is enabled and not muted
                if (audioEnabled && !audioMuted) {
                    spinSound.currentTime = 0;
                    spinSound.loop = true; // Enable looping
                    spinSound.play();
                    
                    // Play tick sound during spinning
                    let tickCount = 0;
                    tickInterval = setInterval(() => {
                        tickSound.currentTime = 0;
                        tickSound.play();
                        tickCount++;
                        
                        if (tickCount > 20) {
                            clearInterval(tickInterval);
                        }
                    }, duration / 20);
                }
                
                // Apply rotation with CSS transition
                wheel.style.transition = `transform ${duration}ms cubic-bezier(0.17, 0.67, 0.12, 0.99)`;
                wheel.style.transform = `rotate(${targetRotation}deg)`;
                
                // Calculate which slice will be selected
                const normalizedRotation = targetRotation % 360;
                const sliceAngle = 360 / slices.length;
                let selectedIndex = Math.floor((360 - normalizedRotation) / sliceAngle) % slices.length;
                
                // Handle edge case where normalizedRotation is exactly 360
                if (selectedIndex < 0) selectedIndex += slices.length;
                
                // Stop spinning after duration and show result
                setTimeout(() => {
                    isSpinning = false;
                    
                    // Remove spinning effects
                    wheelContainer.classList.remove('spinning');
                    clearInterval(fireworkInterval);
                    
                    // Stop spin sound and tick sound
                    spinSound.pause();
                    spinSound.loop = false; // Disable looping
                    spinSound.currentTime = 0; // Reset to beginning
                    if (tickInterval) clearInterval(tickInterval);
                    
                    // Add winner celebration effects
                    resultDisplay.classList.add('winner');
                    
                    // Create massive fireworks celebration
                    for (let i = 0; i < 50; i++) {
                        setTimeout(() => {
                            const x = Math.random() * window.innerWidth;
                            const y = Math.random() * window.innerHeight * 0.7;
                            createFireworks(x, y);
                        }, i * 50);
                    }
                    
                    // Play win sound and confetti sound
                    if (audioEnabled && !audioMuted) {
                        winSound.currentTime = 0;
                        winSound.play();
                        
                        confettiSound.currentTime = 0;
                        confettiSound.play();
                    }
                    
                    // Display result
                    const selectedSlice = slices[selectedIndex];
                    
                    // Update enhanced result display
                    if (resultDisplay && resultContent) {
                        const resultText = resultContent.querySelector('.result-text');
                        if (resultText) {
                            resultText.textContent = selectedSlice.text;
                            resultText.style.color = selectedSlice.color;
                            resultText.style.fontWeight = 'bold';
                            resultText.style.textShadow = `0 0 10px ${selectedSlice.color}`;
                        }
                        
                        // Show the result display with animation
                        setTimeout(() => {
                            resultDisplay.classList.add('show');
                        }, 500);
                        
                        // Add winner effect
                        setTimeout(() => {
                            resultDisplay.classList.add('winner');
                            if (resultCelebration) {
                                resultCelebration.classList.add('show');
                            }
                        }, 800);
                    } else {
                        console.error('Result display elements not found');
                    }
                    
                    // Add to statistics
                    addWinToStats(selectedSlice.text);
                    
                    // Process enhanced features
                    if (typeof processSpinResult === 'function') {
                        processSpinResult(selectedSlice.text);
                    }
                    
                    // Create confetti effect and mega celebration
                    createConfetti();
                    megaCelebration();
                }, duration);
            }
            
            // Create confetti effect
            function createConfetti() {
                const confettiCount = 200;
                const container = document.querySelector('.container');
                
                // Clear any existing confetti
                document.querySelectorAll('.confetti').forEach(el => el.remove());
                
                // Create new confetti
                for (let i = 0; i < confettiCount; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    
                    // Random position, color, size, and shape
                    const left = Math.random() * 100;
                    const color = colorPalette[Math.floor(Math.random() * colorPalette.length)];
                    const size = Math.floor(Math.random() * 10) + 5;
                    const shape = Math.random() > 0.5 ? 'square' : 'circle';
                    
                    confetti.style.left = `${left}%`;
                    confetti.style.top = '-20px';
                    confetti.style.backgroundColor = color;
                    confetti.style.width = `${size}px`;
                    confetti.style.height = `${size}px`;
                    confetti.style.borderRadius = shape === 'circle' ? '50%' : '0';
                    
                    document.body.appendChild(confetti);
                    
                    // Animate confetti falling
                    const animationDuration = Math.random() * 3000 + 2000;
                    const animationDelay = Math.random() * 500;
                    
                    confetti.style.animation = `
                        fall ${animationDuration}ms ease-in ${animationDelay}ms forwards,
                        sway ${animationDuration/1000}s ease-in-out ${animationDelay}ms alternate infinite
                    `;
                    
                    // Define keyframes for falling and swaying
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes fall {
                            to { transform: translateY(100vh) rotate(${Math.random() * 360}deg); }
                        }
                        @keyframes sway {
                            from { transform: translateX(-10px); }
                            to { transform: translateX(10px); }
                        }
                    `;
                    document.head.appendChild(style);
                    
                    // Remove confetti after animation
                    setTimeout(() => {
                        confetti.remove();
                    }, animationDuration + animationDelay);
                }
            }
            
            // Save wheel to localStorage
            function saveWheel() {
                const wheelData = {
                    name: wheelNameInput.value || 'Unnamed Wheel',
                    slices: slices,
                    timestamp: new Date().toISOString()
                };
                
                const savedWheels = JSON.parse(localStorage.getItem('savedWheels') || '[]');
                savedWheels.push(wheelData);
                localStorage.setItem('savedWheels', JSON.stringify(savedWheels));
                
                alert('Wheel saved successfully!');
                loadSavedWheels();
            }
            
            // Load saved wheels from localStorage
            function loadSavedWheels() {
                const savedWheels = JSON.parse(localStorage.getItem('savedWheels') || '[]');
                savedWheelsList.innerHTML = '';
                
                if (savedWheels.length === 0) {
                    savedWheelsList.innerHTML = '<p>No saved wheels yet.</p>';
                    return;
                }
                
                savedWheels.forEach((wheelData, index) => {
                    const wheelItem = document.createElement('div');
                    wheelItem.className = 'saved-wheel-item';
                    
                    const wheelName = document.createElement('div');
                    wheelName.className = 'saved-wheel-name';
                    wheelName.textContent = wheelData.name;
                    
                    const wheelDate = document.createElement('div');
                    wheelDate.className = 'saved-wheel-date';
                    wheelDate.textContent = new Date(wheelData.timestamp).toLocaleDateString();
                    
                    const loadButton = document.createElement('button');
                    loadButton.textContent = 'Load';
                    loadButton.addEventListener('click', () => {
                        loadWheelFromData(wheelData);
                    });
                    
                    const deleteButton = document.createElement('button');
                    deleteButton.className = 'saved-wheel-delete';
                    deleteButton.innerHTML = '<i class="fas fa-times"></i>';
                    deleteButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteWheel(index);
                    });
                    
                    wheelItem.appendChild(wheelName);
                    wheelItem.appendChild(wheelDate);
                    wheelItem.appendChild(loadButton);
                    wheelItem.appendChild(deleteButton);
                    savedWheelsList.appendChild(wheelItem);
                });
            }
            
            // Delete a saved wheel
            function deleteWheel(index) {
                const savedWheels = JSON.parse(localStorage.getItem('savedWheels') || '[]');
                savedWheels.splice(index, 1);
                localStorage.setItem('savedWheels', JSON.stringify(savedWheels));
                loadSavedWheels();
            }
            
            // Load wheel from data
            function loadWheelFromData(wheelData) {
                wheelNameInput.value = wheelData.name;
                sliceCountInput.value = wheelData.slices.length;
                generateWheel();
                
                // Update slice data
                wheelData.slices.forEach((slice, index) => {
                    slices[index].text = slice.text;
                    slices[index].color = slice.color;
                    
                    // Update slice elements
                    const sliceElements = document.querySelectorAll('.wheel-slice');
                    const sliceTextElements = document.querySelectorAll('.wheel-slice-text');
                    const configInputs = document.querySelectorAll('.slice-item input');
                    
                    if (sliceElements[index]) {
                        sliceElements[index].style.background = slice.color;
                    }
                    
                    if (sliceTextElements[index]) {
                        sliceTextElements[index].textContent = slice.text;
                    }
                    
                    if (configInputs[index * 2]) {
                        configInputs[index * 2].value = slice.color;
                    }
                    
                    if (configInputs[index * 2 + 1]) {
                        configInputs[index * 2 + 1].value = slice.text;
                    }
                });
                
                updateWheelData();
            }
            
            // Load wheel from textarea
            function loadWheel() {
                try {
                    const wheelData = JSON.parse(wheelDataTextarea.value);
                    loadWheelFromData(wheelData);
                } catch (e) {
                    alert('Invalid wheel data. Please check the format and try again.');
                    console.error(e);
                }
            }
            
            // Copy wheel data to clipboard
            function copyWheelData() {
                wheelDataTextarea.select();
                document.execCommand('copy');
                alert('Wheel data copied to clipboard!');
            }
            
            // Handle file upload
            function handleFileUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const wheelData = JSON.parse(e.target.result);
                        wheelDataTextarea.value = JSON.stringify(wheelData, null, 2);
                        loadWheel();
                    } catch (error) {
                        alert('Failed to load file. Please make sure it is a valid JSON file.');
                        console.error(error);
                    }
                };
                reader.readAsText(file);
                
                // Reset file input
                event.target.value = '';
            }
            
            // Load a preset wheel
            function loadPresetWheel(presetKey) {
                const preset = presetWheels[presetKey];
                if (!preset) return;
                
                wheelNameInput.value = preset.name;
                sliceCountInput.value = preset.items.length;
                generateWheel();
                
                // Update slice data
                preset.items.forEach((item, index) => {
                    slices[index].text = item;
                    if (preset.colors && preset.colors[index]) {
                        slices[index].color = preset.colors[index];
                    }
                    
                    // Update slice elements
                    const sliceElements = document.querySelectorAll('.wheel-slice');
                    const sliceTextElements = document.querySelectorAll('.wheel-slice-text');
                    const configInputs = document.querySelectorAll('.slice-item input');
                    
                    if (sliceElements[index]) {
                        sliceElements[index].style.background = slices[index].color;
                    }
                    
                    if (sliceTextElements[index]) {
                        sliceTextElements[index].textContent = item;
                    }
                    
                    if (configInputs[index * 2]) {
                        configInputs[index * 2].value = slices[index].color;
                    }
                    
                    if (configInputs[index * 2 + 1]) {
                        configInputs[index * 2 + 1].value = item;
                    }
                });
                
                updateWheelData();
                loadWheelStats(); // Load stats for this preset wheel
                presetWheelsSection.style.display = 'none';
            }
            
            // Initialize the app
            init();
            
            // Initialize enhanced features after a short delay
            setTimeout(() => {
                if (typeof initializeEnhancedFeatures === 'function') {
                    initializeEnhancedFeatures();
                } else {
                    console.log('Enhanced features not loaded yet, retrying...');
                    setTimeout(() => {
                        if (typeof initializeEnhancedFeatures === 'function') {
                            initializeEnhancedFeatures();
                        }
                    }, 1000);
                }
            }, 500);
        });

        // NEW FEATURE FUNCTIONS

        // User Management System with Enhanced Features
        let currentUser = {
            username: 'Guest',
            email: '',
            isLoggedIn: false,
            level: 1,
            xp: 0,
            coins: 100,
            gems: 0,
            achievements: [],
            badges: [],
            isGuest: true,
            joinDate: new Date().toISOString(),
            lastLogin: new Date().toISOString(),
            totalSpins: 0,
            longestStreak: 0,
            favoriteResult: '',
            vipLevel: 0
        };

        // Enhanced Game State Variables
        let gameState = {
            sessionStartTime: Date.now(),
            karma: 60,
            predictions: { correct: 0, total: 0, streak: 0, bestStreak: 0 },
            secretMode: false,
            voiceEnabled: false,
            currentBet: 0,
            activePrediction: '',
            predictionMode: false,
            casinoMode: false,
            battleMode: false,
            spinCount: 0,
            streak: 0,
            longestStreak: 0,
            lastSpinResult: '',
            combo: 0,
            multiplier: 1.0,
            dailySpins: 0,
            lastDailyReset: new Date().toDateString(),
            features: {
                prediction: false,
                casino: false,
                battle: false,
                voice: false
            },
            powerUps: {
                luckyCharm: 0, // +20% better casino odds
                doubleXP: 0,   // 2x XP for limited time
                coinBoost: 0,  // +50% coin rewards
                gemFinder: 0   // Find gems in spins
            },
            achievements: {
                firstSpin: false,
                spinner: false,      // 10 spins
                veteran: false,      // 100 spins
                master: false,       // 1000 spins
                predictor: false,    // 5 correct predictions
                oracle: false,       // 25 correct predictions
                lucky: false,        // Win casino 5 times in a row
                rich: false,         // Have 1000 coins
                gemCollector: false, // Collect 50 gems
                streakMaster: false, // 20 streak
                levelUp10: false,    // Reach level 10
                timePlayer: false,   // Play for 1 hour
                socialite: false     // Share 5 times
            }
        };

        // Initialize login system
        function initializeLogin() {
            const savedUser = localStorage.getItem('wheelUser');
        // Initialize the application without login system
        function initializeApp() {
            // Initialize game without login
            generateWheel();
            initializeGameState();
        }

        function initializeGameState() {
            // Simple game state initialization
            updateDisplays();
        }
        }

        function resetGameState() {
            gameState = {
                sessionStartTime: Date.now(),
                karma: 60,
                predictions: { correct: 0, total: 0 },
                secretMode: false,
                voiceEnabled: false,
                currentBet: 0,
                activePrediction: '',
                predictionMode: false,
                casinoMode: false,
                battleMode: false,
                spinCount: 0,
                streak: 0,
                lastSpinResult: '',
                features: {
                    prediction: false,
                    casino: false,
                    battle: false,
                    voice: false
                }
            };
            updateDisplays();
        }

        function saveGameState() {
            if (!currentUser.isGuest) {
                localStorage.setItem('wheelGameState', JSON.stringify(gameState));
                localStorage.setItem('wheelUser', JSON.stringify(currentUser));
            }
        }

        function updateDisplays() {
            // Currency displays
            const coinsDisplay = document.getElementById('coinsDisplay');
            const gemsDisplay = document.getElementById('gemsDisplay');
            const streakDisplay = document.getElementById('streakDisplay');
            const currentBetDisplay = document.getElementById('currentBet');
            
            if (coinsDisplay) coinsDisplay.textContent = ` ${currentUser.coins}`;
            if (gemsDisplay) gemsDisplay.textContent = ` ${currentUser.gems}`;
            if (streakDisplay) streakDisplay.textContent = ` ${gameState.streak}`;
            if (currentBetDisplay) currentBetDisplay.textContent = gameState.currentBet;

            // Karma system
            const karmaFill = document.getElementById('karmaFill');
            const karmaLevel = document.getElementById('karmaLevel');
            if (karmaFill) karmaFill.style.width = `${gameState.karma}%`;
            if (karmaLevel) {
                if (gameState.karma >= 90) karmaLevel.textContent = 'Legendary';
                else if (gameState.karma >= 80) karmaLevel.textContent = 'Excellent';
                else if (gameState.karma >= 60) karmaLevel.textContent = 'Good';
                else if (gameState.karma >= 40) karmaLevel.textContent = 'Neutral';
                else if (gameState.karma >= 20) karmaLevel.textContent = 'Poor';
                else karmaLevel.textContent = 'Terrible';
            }

            // Prediction stats
            const correctPredictions = document.getElementById('correctPredictions');
            const totalPredictions = document.getElementById('totalPredictions');
            const predictionAccuracy = document.getElementById('predictionAccuracy');
            const predictionStreak = document.getElementById('predictionStreak');
            
            if (correctPredictions) correctPredictions.textContent = gameState.predictions.correct;
            if (totalPredictions) totalPredictions.textContent = gameState.predictions.total;
            if (predictionAccuracy) {
                const accuracy = gameState.predictions.total > 0 ? 
                    Math.round((gameState.predictions.correct / gameState.predictions.total) * 100) : 0;
                predictionAccuracy.textContent = `${accuracy}%`;
            }
            if (predictionStreak) predictionStreak.textContent = gameState.predictions.streak;

            // Level and XP system
            const streakNumber = document.getElementById('streakNumber');
            const levelNumber = document.getElementById('levelNumber');
            const xpText = document.getElementById('xpText');
            const xpFill = document.getElementById('xpFill');

            if (streakNumber) streakNumber.textContent = gameState.streak;
            if (levelNumber) levelNumber.textContent = currentUser.level;
            if (xpText) {
                const xpForNext = currentUser.level * 100;
                xpText.textContent = `${currentUser.xp} / ${xpForNext} XP`;
            }
            if (xpFill) {
                const xpForNext = currentUser.level * 100;
                const percentage = (currentUser.xp / xpForNext) * 100;
                xpFill.style.width = `${Math.min(percentage, 100)}%`;
            }

            // Update user stats in header
            const userStats = document.getElementById('userStats');
            const userBadges = document.getElementById('userBadges');
            if (userStats) {
                userStats.textContent = `Level ${currentUser.level}  ${currentUser.xp} XP`;
                if (currentUser.vipLevel > 0) {
                    userStats.textContent += `  VIP ${currentUser.vipLevel}`;
                }
            }

            // Update badges display
            if (userBadges) {
                userBadges.innerHTML = '';
                currentUser.badges.forEach(badge => {
                    const badgeEl = document.createElement('span');
                    badgeEl.className = 'badge';
                    badgeEl.textContent = badge;
                    userBadges.appendChild(badgeEl);
                });
            }

            // Daily reset check
            checkDailyReset();
            
            // Power-up timers
            updatePowerUpTimers();
        }

        function checkDailyReset() {
            const today = new Date().toDateString();
            if (gameState.lastDailyReset !== today) {
                gameState.dailySpins = 0;
                gameState.lastDailyReset = today;
                showNotification(' Daily reset! New challenges await!', 'info');
            }
        }

        function updatePowerUpTimers() {
            const now = Date.now();
            Object.keys(gameState.powerUps).forEach(powerUp => {
                if (gameState.powerUps[powerUp] > 0 && gameState.powerUps[powerUp] < now) {
                    gameState.powerUps[powerUp] = 0;
                    showNotification(` ${powerUp} power-up expired!`, 'info');
                }
            });
        }

        // Enhanced wheel spin function that integrates with all features
        function enhancedSpinWheel() {
            if (spinning) {
                console.log('Wheel is already spinning');
                return;
            }

            // Pre-spin checks and predictions
            const predictionInput = document.getElementById('predictionInput');
            if (gameState.features.prediction && predictionInput && predictionInput.value.trim()) {
                gameState.activePrediction = predictionInput.value.trim().toLowerCase();
            }

            // Casino bet check
            if (gameState.features.casino && gameState.currentBet > 0) {
                if (gameState.currentBet > currentUser.coins) {
                    showNotification('Not enough coins!', 'error');
                    return;
                }
                currentUser.coins -= gameState.currentBet;
            }

            // Call original spin function
            spinWheel();

            // Post-spin processing will happen in the result callback
        }

        // Enhanced result processing with exciting features
        function processSpinResult(result) {
            gameState.lastSpinResult = result;
            gameState.spinCount++;
            gameState.dailySpins++;
            currentUser.totalSpins++;
            
            // Calculate base rewards
            let coinReward = 5 + Math.floor(Math.random() * 5); // 5-9 coins
            let xpReward = 10 + gameState.streak;
            let gemChance = 0.05; // 5% base chance for gems
            
            // Apply power-ups
            if (gameState.powerUps.coinBoost > Date.now()) {
                coinReward = Math.floor(coinReward * 1.5);
            }
            if (gameState.powerUps.doubleXP > Date.now()) {
                xpReward *= 2;
            }
            if (gameState.powerUps.gemFinder > Date.now()) {
                gemChance = 0.2; // 20% chance with gem finder
            }

            // Streak system
            if (gameState.lastSpinResult === result && gameState.spinCount > 1) {
                gameState.streak++;
                gameState.combo++;
                if (gameState.streak > gameState.longestStreak) {
                    gameState.longestStreak = gameState.streak;
                }
                if (gameState.streak > currentUser.longestStreak) {
                    currentUser.longestStreak = gameState.streak;
                }
                
                // Streak bonuses
                if (gameState.streak >= 5) {
                    coinReward += gameState.streak * 2;
                    xpReward += gameState.streak * 5;
                    gemChance += 0.1;
                }
            } else {
                gameState.streak = 1;
                gameState.combo = 0;
            }

            // Check prediction
            if (gameState.features.prediction && gameState.activePrediction) {
                checkPrediction(result);
            }

            // Process casino bet
            if (gameState.features.casino && gameState.currentBet > 0) {
                processCasinoBet(result);
            }

            // Random gem drop
            if (Math.random() < gemChance) {
                const gemsFound = Math.floor(Math.random() * 3) + 1;
                currentUser.gems += gemsFound;
                showNotification(` Found ${gemsFound} gems!`, 'achievement');
                createGemEffect();
            }

            // Special result bonuses
            processSpecialResults(result);

            // Update karma based on result
            updateKarma(result);

            // Add rewards
            currentUser.coins += coinReward;
            addXP(xpReward);

            // Check achievements
            checkAchievements();

            // Update displays
            updateDisplays();
            saveGameState();

            // Reset active features
            gameState.activePrediction = '';
            gameState.currentBet = 0;

            // Show spin summary
            showSpinSummary(result, coinReward, xpReward);
        }

        function processSpecialResults(result) {
            const specialResults = {
                'JACKPOT': () => {
                    const bonus = 100 + Math.floor(Math.random() * 200);
                    currentUser.coins += bonus;
                    currentUser.gems += 5;
                    showNotification(` MEGA JACKPOT! +${bonus} coins, +5 gems!`, 'jackpot');
                    createMegaCelebration();
                },
                'BONUS': () => {
                    const bonus = 50 + Math.floor(Math.random() * 100);
                    currentUser.coins += bonus;
                    showNotification(` BONUS ROUND! +${bonus} coins!`, 'achievement');
                },
                'LUCKY': () => {
                    gameState.powerUps.luckyCharm = Date.now() + 300000; // 5 minutes
                    showNotification(` Lucky Charm activated for 5 minutes!`, 'powerup');
                },
                'DOUBLE': () => {
                    gameState.powerUps.doubleXP = Date.now() + 180000; // 3 minutes
                    showNotification(` Double XP activated for 3 minutes!`, 'powerup');
                },
                'GEMS': () => {
                    const gems = 3 + Math.floor(Math.random() * 5);
                    currentUser.gems += gems;
                    showNotification(` Gem shower! +${gems} gems!`, 'achievement');
                }
            };

            if (specialResults[result.toUpperCase()]) {
                specialResults[result.toUpperCase()]();
            }
        }

        function showSpinSummary(result, coins, xp) {
            const summary = ` "${result}" | +${coins} coins | +${xp} XP`;
            if (gameState.streak > 1) {
                summary += ` |  ${gameState.streak} streak!`;
            }
            showNotification(summary, 'spin-result');
        }

        function createGemEffect() {
            // Create sparkling gem effects
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const gem = document.createElement('div');
                    gem.innerHTML = '';
                    gem.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        font-size: 24px;
                        pointer-events: none;
                        z-index: 9999;
                        animation: gemFloat 2s ease-out forwards;
                        transform: translate(-50%, -50%);
                    `;
                    document.body.appendChild(gem);
                    
                    setTimeout(() => gem.remove(), 2000);
                }, i * 100);
            }
        }

        function createMegaCelebration() {
            // Enhanced celebration for special events
            document.body.style.animation = 'rainbow 2s ease-in-out';
            setTimeout(() => {
                document.body.style.animation = '';
            }, 2000);
            
            // Create extra fireworks
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const x = Math.random() * window.innerWidth;
                    const y = Math.random() * window.innerHeight * 0.8;
                    createFireworks(x, y);
                }, i * 100);
            }
        }

        function checkPrediction(result) {
            const feedback = document.getElementById('predictionFeedback');
            gameState.predictions.total++;
            
            if (gameState.activePrediction === result.toLowerCase()) {
                gameState.predictions.correct++;
                if (feedback) {
                    feedback.className = 'prediction-feedback prediction-correct';
                    feedback.textContent = ' Correct prediction! +25 XP';
                    feedback.style.display = 'block';
                }
                addXP(25);
                currentUser.coins += 15;
                gameState.karma += 5;
                showNotification('Perfect prediction!', 'achievement');
            } else {
                if (feedback) {
                    feedback.className = 'prediction-feedback prediction-wrong';
                    feedback.textContent = ` Wrong! It was "${result}". Try again!`;
                    feedback.style.display = 'block';
                }
                gameState.karma -= 1;
            }
            
            // Clear prediction input
            const predictionInput = document.getElementById('predictionInput');
            if (predictionInput) predictionInput.value = '';
        }

        function processCasinoBet(result) {
            const winChance = 0.3 + (gameState.karma / 200); // Karma affects win chance
            const isWin = Math.random() < winChance;
            
            if (isWin) {
                const multiplier = Math.random() > 0.8 ? 3 : 2;
                const winnings = gameState.currentBet * multiplier;
                currentUser.coins += winnings;
                showNotification(`Casino Win! +${winnings} coins!`, 'achievement');
                gameState.karma += 3;
                addXP(20);
            } else {
                showNotification(`Casino Loss! -${gameState.currentBet} coins`, 'error');
                gameState.karma -= 2;
            }
        }

        function checkAchievements() {
            const achievements = [
                {
                    id: 'firstSpin',
                    name: ' First Spin',
                    desc: 'Spin the wheel for the first time',
                    condition: () => gameState.spinCount >= 1,
                    reward: { coins: 10, gems: 1 }
                },
                {
                    id: 'spinner',
                    name: ' Spinner',
                    desc: 'Complete 10 spins',
                    condition: () => currentUser.totalSpins >= 10,
                    reward: { coins: 50, gems: 2 }
                },
                {
                    id: 'veteran',
                    name: ' Veteran',
                    desc: 'Complete 100 spins',
                    condition: () => currentUser.totalSpins >= 100,
                    reward: { coins: 200, gems: 10, badge: 'Veteran' }
                },
                {
                    id: 'master',
                    name: ' Spin Master',
                    desc: 'Complete 1000 spins',
                    condition: () => currentUser.totalSpins >= 1000,
                    reward: { coins: 1000, gems: 50, badge: 'Master', vip: 1 }
                },
                {
                    id: 'predictor',
                    name: ' Predictor',
                    desc: 'Make 5 correct predictions',
                    condition: () => gameState.predictions.correct >= 5,
                    reward: { coins: 100, gems: 5 }
                },
                {
                    id: 'oracle',
                    name: ' Oracle',
                    desc: 'Make 25 correct predictions',
                    condition: () => gameState.predictions.correct >= 25,
                    reward: { coins: 500, gems: 20, badge: 'Oracle' }
                },
                {
                    id: 'lucky',
                    name: ' Lucky Streak',
                    desc: 'Win casino 5 times in a row',
                    condition: () => gameState.casinoWinStreak >= 5,
                    reward: { coins: 300, powerup: 'luckyCharm' }
                },
                {
                    id: 'rich',
                    name: ' Rich',
                    desc: 'Accumulate 1000 coins',
                    condition: () => currentUser.coins >= 1000,
                    reward: { gems: 15, badge: 'Rich' }
                },
                {
                    id: 'gemCollector',
                    name: ' Gem Collector',
                    desc: 'Collect 50 gems',
                    condition: () => currentUser.gems >= 50,
                    reward: { coins: 500, powerup: 'gemFinder' }
                },
                {
                    id: 'streakMaster',
                    name: ' Streak Master',
                    desc: 'Achieve a 20 spin streak',
                    condition: () => gameState.longestStreak >= 20,
                    reward: { coins: 400, gems: 25, badge: 'Streak Master' }
                },
                {
                    id: 'levelUp10',
                    name: ' Level 10',
                    desc: 'Reach level 10',
                    condition: () => currentUser.level >= 10,
                    reward: { coins: 300, gems: 30, vip: 1 }
                },
                {
                    id: 'timePlayer',
                    name: ' Time Player',
                    desc: 'Play for 1 hour total',
                    condition: () => (Date.now() - gameState.sessionStartTime) >= 3600000,
                    reward: { coins: 200, powerup: 'doubleXP' }
                },
                {
                    id: 'socialite',
                    name: ' Socialite',
                    desc: 'Share results 5 times',
                    condition: () => gameState.sharesCount >= 5,
                    reward: { coins: 150, gems: 10 }
                }
            ];

            achievements.forEach(achievement => {
                if (!gameState.achievements[achievement.id] && achievement.condition()) {
                    unlockAchievement(achievement);
                }
            });
        }

        function unlockAchievement(achievement) {
            gameState.achievements[achievement.id] = true;
            currentUser.achievements.push(achievement.id);
            
            // Apply rewards
            if (achievement.reward.coins) {
                currentUser.coins += achievement.reward.coins;
            }
            if (achievement.reward.gems) {
                currentUser.gems += achievement.reward.gems;
            }
            if (achievement.reward.badge) {
                currentUser.badges.push(achievement.reward.badge);
            }
            if (achievement.reward.vip) {
                currentUser.vipLevel = Math.max(currentUser.vipLevel, achievement.reward.vip);
            }
            if (achievement.reward.powerup) {
                activatePowerUp(achievement.reward.powerup);
            }

            // Show achievement notification
            showNotification(` Achievement Unlocked: ${achievement.name}!`, 'achievement');
            createAchievementEffect();
            
            saveGameState();
        }

        function activatePowerUp(powerUpName) {
            const duration = {
                luckyCharm: 600000,  // 10 minutes
                doubleXP: 300000,    // 5 minutes
                coinBoost: 300000,   // 5 minutes
                gemFinder: 600000    // 10 minutes
            };
            
            gameState.powerUps[powerUpName] = Date.now() + duration[powerUpName];
            showNotification(` ${powerUpName} activated!`, 'powerup');
        }

        function addXP(amount) {
            // Apply multipliers
            if (gameState.powerUps.doubleXP > Date.now()) {
                amount *= 2;
            }
            
            // VIP bonus
            if (currentUser.vipLevel > 0) {
                amount *= (1 + currentUser.vipLevel * 0.1);
            }
            
            currentUser.xp += Math.floor(amount);
            const xpForNext = currentUser.level * 100;
            
            if (currentUser.xp >= xpForNext) {
                levelUp();
            }
        }

        function levelUp() {
            currentUser.level++;
            const oldXP = currentUser.xp;
            const xpForPrevious = (currentUser.level - 1) * 100;
            currentUser.xp = oldXP - xpForPrevious;
            
            // Level up rewards
            const coinReward = currentUser.level * 20;
            const gemReward = Math.floor(currentUser.level / 5) + 1;
            
            currentUser.coins += coinReward;
            currentUser.gems += gemReward;
            
            // Special level milestones
            if (currentUser.level % 5 === 0) {
                activatePowerUp('coinBoost');
            }
            if (currentUser.level % 10 === 0) {
                currentUser.vipLevel++;
                currentUser.badges.push(`Level ${currentUser.level}`);
            }
            
            showNotification(` Level ${currentUser.level}! +${coinReward} coins, +${gemReward} gems!`, 'level-up');
            createLevelUpEffect();
        }

        function createLevelUpEffect() {
            // Create spectacular level up effect
            document.body.style.background = 'linear-gradient(45deg, gold, orange, gold)';
            document.body.style.animation = 'levelUpGlow 2s ease-in-out';
            
            setTimeout(() => {
                document.body.style.background = '';
                document.body.style.animation = '';
            }, 2000);
            
            // Create level up particles
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.innerHTML = ['', '', '', ''][Math.floor(Math.random() * 4)];
                    particle.style.cssText = `
                        position: fixed;
                        top: ${20 + Math.random() * 60}%;
                        left: ${20 + Math.random() * 60}%;
                        font-size: ${15 + Math.random() * 15}px;
                        pointer-events: none;
                        z-index: 9999;
                        animation: levelUpFloat 3s ease-out forwards;
                    `;
                    document.body.appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 3000);
                }, i * 30);
            }
        }

        function updateKarma(result) {
            // Karma changes based on various factors
            if (gameState.spinCount % 10 === 0) {
                gameState.karma += 2; // Reward consistent playing
            }
            
            if (gameState.streak > 5) {
                gameState.karma += 1; // Reward streaks
            }
            
            // Keep karma in bounds
            gameState.karma = Math.max(0, Math.min(100, gameState.karma));
        }

        // Feature activation functions
        function togglePredictionMode() {
            gameState.features.prediction = !gameState.features.prediction;
            const panel = document.getElementById('predictionMode');
            if (panel) {
                if (gameState.features.prediction) {
                    panel.classList.add('feature-active');
                    showNotification('Prediction mode activated!', 'achievement');
                } else {
                    panel.classList.remove('feature-active');
                    showNotification('Prediction mode deactivated', 'info');
                }
            }
        }

        function toggleCasinoMode() {
            gameState.features.casino = !gameState.features.casino;
            const panel = document.getElementById('wheelCasino');
            if (panel) {
                if (gameState.features.casino) {
                    panel.classList.add('feature-active');
                    showNotification('Casino mode activated!', 'achievement');
                } else {
                    panel.classList.remove('feature-active');
                    showNotification('Casino mode deactivated', 'info');
                    gameState.currentBet = 0;
                }
            }
        }

        // Casino Functions
        function placeBet(amount) {
            if (!gameState.features.casino) {
                showNotification('Activate casino mode first!', 'error');
                return;
            }
            
            if (amount <= currentUser.coins) {
                gameState.currentBet = amount;
                showNotification(`Bet placed: ${amount} coins`, 'info');
                updateDisplays();
            } else {
                showNotification('Not enough coins!', 'error');
            }
        }

        function casinoSpin() {
            if (!gameState.features.casino) {
                toggleCasinoMode();
            }
            
            if (gameState.currentBet === 0) {
                showNotification('Place a bet first!', 'error');
                return;
            }
            
            enhancedSpinWheel();
        }

        // Wheel Battle Functions
        function startWheelBattle() {
            if (currentUser.isGuest) {
                showNotification('Login required for battles!', 'error');
                return;
            }
            
            const wheel1 = document.getElementById('battleWheel1');
            const wheel2 = document.getElementById('battleWheel2');
            
            wheel1.classList.remove('winner');
            wheel2.classList.remove('winner');
            
            showNotification('Battle starting...', 'info');
            
            setTimeout(() => {
                const winner = Math.random() > 0.5 ? wheel1 : wheel2;
                winner.classList.add('winner');
                
                if (winner === wheel1) {
                    showNotification('You win the battle! +50 XP', 'achievement');
                    addXP(50);
                    currentUser.coins += 25;
                } else {
                    showNotification('You lost the battle! +10 XP for trying', 'info');
                    addXP(10);
                }
                
                gameState.karma += 3;
                updateDisplays();
                saveGameState();
            }, 2000);
        }

        // Weather Functions (simplified)
        function updateWeather() {
            const weatherDescriptions = [
                { icon: '', desc: 'Sunny Day', temp: '22C' },
                { icon: '', desc: 'Partly Cloudy', temp: '18C' },
                { icon: '', desc: 'Rainy', temp: '15C' },
                { icon: '', desc: 'Snowy', temp: '-2C' },
                { icon: '', desc: 'Stormy', temp: '16C' },
                { icon: '', desc: 'Rainbow Weather', temp: '20C' }
            ];
            
            const weather = weatherDescriptions[Math.floor(Math.random() * weatherDescriptions.length)];
            
            const weatherIcon = document.getElementById('weatherIcon');
            const weatherDesc = document.getElementById('weatherDesc');
            const temperature = document.getElementById('temperature');
            
            if (weatherIcon) weatherIcon.textContent = weather.icon;
            if (weatherDesc) weatherDesc.textContent = weather.desc;
            if (temperature) temperature.textContent = weather.temp;
        }

        // Voice Control Functions
        let recognition = null;

        function toggleVoiceControl() {
            if (!gameState.features.voice) {
                startVoiceRecognition();
            } else {
                stopVoiceRecognition();
            }
        }

        function startVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';

                recognition.onstart = function() {
                    gameState.features.voice = true;
                    document.getElementById('micButton').classList.add('listening');
                    document.getElementById('voiceStatus').textContent = 'Listening...';
                };

                recognition.onresult = function(event) {
                    const command = event.results[0][0].transcript.toLowerCase();
                    handleVoiceCommand(command);
                };

                recognition.onerror = function() {
                    gameState.features.voice = false;
                    document.getElementById('micButton').classList.remove('listening');
                    document.getElementById('voiceStatus').textContent = 'Voice recognition error';
                };

                recognition.onend = function() {
                    gameState.features.voice = false;
                    document.getElementById('micButton').classList.remove('listening');
                    document.getElementById('voiceStatus').textContent = 'Click to start listening';
                };

                recognition.start();
            } else {
                showNotification('Voice recognition not supported', 'error');
            }
        }

        function stopVoiceRecognition() {
            if (recognition) {
                recognition.stop();
            }
        }

        function handleVoiceCommand(command) {
            document.getElementById('voiceStatus').textContent = `Command: "${command}"`;
            
            if (command.includes('spin')) {
                enhancedSpinWheel();
                showNotification('Voice command: Spin!', 'achievement');
            } else if (command.includes('generate')) {
                generateWheel();
                showNotification('Voice command: Generate!', 'achievement');
            } else if (command.includes('casino')) {
                toggleCasinoMode();
                showPanel('wheelCasino');
            } else if (command.includes('predict')) {
                togglePredictionMode();
                showPanel('predictionMode');
            } else if (command.includes('battle')) {
                showPanel('wheelBattles');
            }
        }

        // Simplified versions of other functions
        function changeBackground(bgType) {
            document.querySelectorAll('.bg-option').forEach(opt => opt.classList.remove('active'));
            event.target.classList.add('active');
            
            const backgrounds = {
                space: 'linear-gradient(135deg, #000428, #004e92)',
                ocean: 'linear-gradient(135deg, #667eea, #764ba2)',
                sunset: 'linear-gradient(135deg, #f093fb, #f5576c)',
                forest: 'linear-gradient(135deg, #4facfe, #00f2fe)'
            };
            
            document.body.style.background = backgrounds[bgType];
            document.body.style.backgroundSize = '400% 400%';
            document.body.style.animation = 'gradientBG 15s ease infinite';
        }

        function spinSlots() {
            const symbols = ['', '', '', '', '', '', '7'];
            const results = [];
            
            for (let i = 0; i < 3; i++) {
                results.push(symbols[Math.floor(Math.random() * symbols.length)]);
            }
            
            const slots = [
                document.getElementById('slot1'),
                document.getElementById('slot2'),
                document.getElementById('slot3')
            ];
            
            slots.forEach((slot, index) => {
                if (slot) {
                    slot.style.animation = 'slotSpin 2s ease-out';
                    setTimeout(() => {
                        slot.innerHTML = `<div class="slot-symbol">${results[index]}</div>`;
                        slot.style.animation = '';
                    }, 2000);
                }
            });
            
            setTimeout(() => {
                const resultDiv = document.getElementById('slotResult');
                if (results[0] === results[1] && results[1] === results[2]) {
                    resultDiv.textContent = ' JACKPOT! +50 coins, karma boost!';
                    currentUser.coins += 50;
                    gameState.karma += 10;
                    addXP(30);
                } else if (results[0] === results[1] || results[1] === results[2] || results[0] === results[2]) {
                    resultDiv.textContent = ' Small win! +10 coins!';
                    currentUser.coins += 10;
                    gameState.karma += 3;
                    addXP(10);
                } else {
                    resultDiv.textContent = 'Try again for better luck!';
                }
                updateDisplays();
                saveGameState();
            }, 2100);
        }

        function shareToSocial(platform) {
            if (currentUser.isGuest) {
                showNotification('Login to unlock sharing features!', 'error');
                return;
            }
            
            const message = document.getElementById('shareMessage').value || `I just spun the Ultimate Wheel and got "${gameState.lastSpinResult}"! `;
            const url = window.location.href;
            
            navigator.clipboard.writeText(message + ' ' + url).then(() => {
                showNotification(`Result copied! Share on ${platform}!`, 'achievement');
                addXP(5);
                currentUser.coins += 2;
                updateDisplays();
            });
        }

        // Enhanced Power-Up Shop System
        function buyPowerUp(powerUpName, cost) {
            if (currentUser.gems < cost) {
                showNotification('Not enough gems!', 'error');
                return;
            }

            if (gameState.powerUps[powerUpName] > Date.now()) {
                showNotification('Power-up already active!', 'error');
                return;
            }

            currentUser.gems -= cost;
            activatePowerUp(powerUpName);
            showNotification(` ${powerUpName} purchased and activated!`, 'achievement');
            updateDisplays();
            saveGameState();
        }

        // Daily Challenges System
        function updateChallengeProgress() {
            // Spin challenge
            const spinProgress = Math.min(gameState.dailySpins, 20);
            const spinPercent = (spinProgress / 20) * 100;
            const spinProgressBar = document.getElementById('spinProgress');
            const spinProgressText = document.getElementById('spinProgressText');
            
            if (spinProgressBar) spinProgressBar.style.width = `${spinPercent}%`;
            if (spinProgressText) spinProgressText.textContent = `${spinProgress}/20`;
            
            if (spinProgress >= 20 && !gameState.dailyChallenges?.spinMaster) {
                completeDailyChallenge('spinMaster', { coins: 100, gems: 5 });
            }

            // Prediction challenge
            const predictionProgress = Math.min(gameState.predictions.correct, 5);
            const predictionPercent = (predictionProgress / 5) * 100;
            const predictionProgressBar = document.getElementById('predictionProgress');
            const predictionProgressText = document.getElementById('predictionProgressText');
            
            if (predictionProgressBar) predictionProgressBar.style.width = `${predictionPercent}%`;
            if (predictionProgressText) predictionProgressText.textContent = `${predictionProgress}/5`;
            
            if (predictionProgress >= 5 && !gameState.dailyChallenges?.perfectPredictor) {
                completeDailyChallenge('perfectPredictor', { coins: 150, powerup: 'doubleXP' });
            }

            // Casino challenge
            const casinoProgress = Math.min(gameState.dailyCasinoWins || 0, 500);
            const casinoPercent = (casinoProgress / 500) * 100;
            const casinoProgressBar = document.getElementById('casinoProgress');
            const casinoProgressText = document.getElementById('casinoProgressText');
            
            if (casinoProgressBar) casinoProgressBar.style.width = `${casinoPercent}%`;
            if (casinoProgressText) casinoProgressText.textContent = `${casinoProgress}/500`;
            
            if (casinoProgress >= 500 && !gameState.dailyChallenges?.highRoller) {
                completeDailyChallenge('highRoller', { gems: 20, powerup: 'luckyCharm' });
            }
        }

        function completeDailyChallenge(challengeId, reward) {
            if (!gameState.dailyChallenges) {
                gameState.dailyChallenges = {};
            }
            
            gameState.dailyChallenges[challengeId] = true;
            
            // Apply rewards
            if (reward.coins) {
                currentUser.coins += reward.coins;
            }
            if (reward.gems) {
                currentUser.gems += reward.gems;
            }
            if (reward.powerup) {
                activatePowerUp(reward.powerup);
            }
            
            showNotification(` Daily Challenge Complete: ${challengeId}!`, 'achievement');
            createAchievementEffect();
            updateDisplays();
            saveGameState();
        }

        // Enhanced Menu System
        function enhanceMenuSystem() {
            const menuPanel = document.getElementById('menuPanel');
            if (menuPanel) {
                const newButtons = [
                    { id: 'powerUpShopBtn', text: ' Power-Up Shop', panel: 'powerUpShop' },
                    { id: 'dailyChallengesBtn', text: ' Daily Challenges', panel: 'dailyChallenges' },
                    { id: 'wheelBattlesBtn', text: ' Wheel Battles', panel: 'wheelBattles' },
                    { id: 'wheelCasinoBtn', text: ' Wheel Casino', panel: 'wheelCasino' },
                    { id: 'weatherWheelBtn', text: ' Weather Wheel', panel: 'weatherWheel' },
                    { id: 'multiplayerBtn', text: ' Multiplayer', panel: 'multiplayerLobby' },
                    { id: 'socialBtn', text: ' Share Results', panel: 'socialPanel' },
                    { id: 'miniGamesBtn', text: ' Mini Games', panel: 'miniGames' },
                    { id: 'voiceControlBtn', text: ' Voice Control', panel: 'voiceControl' },
                    { id: 'backgroundBtn', text: ' Backgrounds', panel: 'backgroundSelector' },
                    { id: 'leaderboardBtn', text: ' Leaderboard', panel: 'leaderboard' },
                    { id: 'customizerBtn', text: ' Wheel Designer', panel: 'wheelCustomizer' },
                    { id: 'slotMachineBtn', text: ' Lucky Slots', panel: 'slotMachine' },
                    { id: 'predictionBtn', text: ' Prediction Mode', panel: 'predictionMode' },
                    { id: 'karmaBtn', text: ' Karma System', panel: 'karmaDisplay' },
                    { id: 'secretBtn', text: ' Secrets', panel: 'secretAchievement' }
                ];

                newButtons.forEach(btn => {
                    const existingBtn = document.getElementById(btn.id);
                    if (!existingBtn) {
                        const button = document.createElement('button');
                        button.id = btn.id;
                        button.innerHTML = btn.text;
                        button.style.cssText = 'margin: 5px 0; padding: 10px 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: all 0.2s ease;';
                        button.addEventListener('click', () => {
                            showPanel(btn.panel);
                            toggleMenu();
                        });
                        button.addEventListener('mouseenter', () => {
                            button.style.transform = 'translateY(-2px)';
                            button.style.boxShadow = '0 4px 15px rgba(102, 126, 234, 0.3)';
                        });
                        button.addEventListener('mouseleave', () => {
                            button.style.transform = 'translateY(0)';
                            button.style.boxShadow = 'none';
                        });
                        menuPanel.appendChild(button);
                    }
                });
            }
        }

        function startSessionTimer() {
            setInterval(() => {
                const elapsed = Date.now() - gameState.sessionStartTime;
                const hours = Math.floor(elapsed / 3600000);
                const minutes = Math.floor((elapsed % 3600000) / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                
                const timerDisplay = document.getElementById('sessionTimer');
                if (timerDisplay) {
                    timerDisplay.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }

        function takeBreak() {
            showNotification('Good choice! Take care! +10 XP', 'achievement');
            addXP(10);
            gameState.karma += 5;
            updateDisplays();
            hidePanel('realityCheck');
            gameState.sessionStartTime = Date.now();
        }

        function activateSecretMode() {
            gameState.secretMode = true;
            showNotification('Secret Mode Activated! ', 'achievement');
            currentUser.coins += 100;
            gameState.karma = 100;
            addXP(100);
            updateDisplays();
            saveGameState();
            hidePanel('secretAchievement');
        }

        function showPanel(panelId) {
            const panels = [
                'powerUpShop', 'dailyChallenges', 'wheelBattles', 'wheelCasino', 
                'weatherWheel', 'multiplayerLobby', 'socialPanel', 'miniGames', 
                'voiceControl', 'backgroundSelector', 'leaderboard', 'wheelCustomizer', 
                'slotMachine', 'predictionMode', 'realityCheck', 'tournamentBracket', 
                'karmaDisplay', 'secretAchievement'
            ];
            
            panels.forEach(id => {
                const panel = document.getElementById(id);
                if (panel) panel.style.display = 'none';
            });
            
            const panel = document.getElementById(panelId);
            if (panel) {
                panel.style.display = 'block';
                
                // Special activation logic
                if (panelId === 'predictionMode') {
                    gameState.features.prediction = true;
                    panel.classList.add('feature-active');
                } else if (panelId === 'wheelCasino') {
                    gameState.features.casino = true;
                    panel.classList.add('feature-active');
                } else if (panelId === 'dailyChallenges') {
                    updateChallengeProgress();
                }
            }
        }

        function hidePanel(panelId) {
            const panel = document.getElementById(panelId);
            if (panel) {
                panel.style.display = 'none';
                panel.classList.remove('feature-active');
            }
            
            // Deactivate features when panels are hidden
            if (panelId === 'predictionMode') {
                gameState.features.prediction = false;
            } else if (panelId === 'wheelCasino') {
                gameState.features.casino = false;
                gameState.currentBet = 0;
            }
        }

        // Initialize everything
        function initializeEnhancedFeatures() {
            // Initialize login system
            initializeLogin();
            
            // Initialize the application without login
            initializeApp();
            
            // Start session timer
            startSessionTimer();
            updateWeather();
        }

        // Call initialization after a short delay
        setTimeout(() => {
            initializeEnhancedFeatures();
            enhanceMenuSystem();
            
            // Update challenge progress every 30 seconds
            setInterval(updateChallengeProgress, 30000);
            
            // Check for secret achievement trigger
            let clickCount = 0;
            document.addEventListener('click', () => {
                clickCount++;
                if (clickCount === 50) {
                    showPanel('secretAchievement');
                }
            });
        }, 500);
    </script>
</body>
</html>
